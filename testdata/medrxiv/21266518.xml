<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2d1 20170631//EN" "JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="article" dtd-version="1.2d1" specific-use="production" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">MEDRXIV</journal-id>
<journal-title-group>
<journal-title>medRxiv</journal-title>
<abbrev-journal-title abbrev-type="publisher">medRxiv</abbrev-journal-title>
</journal-title-group>
<publisher>
<publisher-name>Cold Spring Harbor Laboratory</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1101/2021.11.18.21266518</article-id>
<article-version>1.1</article-version>
<article-categories>
<subj-group subj-group-type="hwp-journal-coll">
<subject>Health Informatics</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Trajectories: a framework for detecting temporal clinical event sequences from health data standardized to the OMOP Common Data Model</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8568-1479</contrib-id>
<name><surname>K&#x00FC;nnapuu</surname><given-names>Kadri</given-names></name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1715-288X</contrib-id>
<name><surname>Ioannou</surname><given-names>Solomon</given-names></name>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-6145-5629</contrib-id>
<name><surname>Ligi</surname><given-names>Kadri</given-names></name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2886-6298</contrib-id>
<name><surname>Kolde</surname><given-names>Raivo</given-names></name>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9891-3347</contrib-id>
<name><surname>Laur</surname><given-names>Sven</given-names></name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5604-4107</contrib-id>
<name><surname>Vilo</surname><given-names>Jaak</given-names></name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a3">3</xref>
<xref ref-type="aff" rid="a4">4</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0621-1979</contrib-id>
<name><surname>Rijnbeek</surname><given-names>Peter R.</given-names></name>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6835-9632</contrib-id>
<name><surname>Reisberg</surname><given-names>Sulev</given-names></name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a3">3</xref>
<xref ref-type="aff" rid="a4">4</xref>
<xref ref-type="corresp" rid="cor1">&#x002A;</xref>
</contrib>
<aff id="a1"><label>1</label><institution>STACC</institution>, Tartu, <country>Estonia</country></aff>
<aff id="a2"><label>2</label><institution>Department of Medical Informatics, Erasmus University Medical Center</institution>, Rotterdam, <country>The Netherlands</country></aff>
<aff id="a3"><label>3</label><institution>Institute of Computer Science, University of Tartu</institution>, Tartu, <country>Estonia</country></aff>
<aff id="a4"><label>4</label><institution>Quretec</institution>, Tartu, <country>Estonia</country></aff>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>&#x002A;</label><bold>Corresponding author:</bold> Sulev Reisberg, E-mail: <email>sulev.reisberg@ut.ee</email></corresp>
</author-notes>
<pub-date pub-type="epub">
<year>2021</year>
</pub-date>
<elocation-id>2021.11.18.21266518</elocation-id>
<history>
<date date-type="received">
<day>18</day>
<month>11</month>
<year>2021</year>
</date>
<date date-type="rev-recd">
<day>18</day>
<month>11</month>
<year>2021</year>
</date>
<date date-type="accepted">
<day>19</day>
<month>11</month>
<year>2021</year>
</date>
</history>
<permissions>
<copyright-statement>&#x00A9; 2021, Posted by Cold Spring Harbor Laboratory</copyright-statement>
<copyright-year>2021</copyright-year>
<license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><license-p>This pre-print is available under a Creative Commons License (Attribution-NonCommercial-NoDerivs 4.0 International), CC BY-NC-ND 4.0, as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc-nd/4.0/">http://creativecommons.org/licenses/by-nc-nd/4.0/</ext-link></license-p></license>
</permissions>
<self-uri xlink:href="21266518.pdf" content-type="pdf" xlink:role="full-text"/>
<abstract>
<title>ABSTRACT</title>
<sec>
<title>Objective</title>
<p>To develop a framework for identifying prominent clinical event trajectories from OMOP-formatted observational healthcare data.</p>
</sec>
<sec>
<title>Methods</title>
<p>A four-step framework based on significant temporal event pair detection is described and implemented as an open-source R package. It is used on a population-based Estonian dataset to first replicate a large Danish population-based study and second, to conduct a disease trajectory detection study for Type 2 Diabetes patients in the Estonian and Dutch databases as an example.</p>
</sec>
<sec>
<title>Results</title>
<p>As a proof of concept, we apply the methods in the Estonian database and provide a detailed breakdown of our findings. All Estonian population-based event pairs are shown. We compare the event pairs identified from Estonia to Danish and Dutch data and discuss the causes of the differences.</p>
</sec>
<sec>
<title>Conclusions</title>
<p>For the first time, there is a complete software package for detecting disease trajectories in health data.</p>
</sec>
</abstract>
<kwd-group kwd-group-type="author">
<title>Keywords</title>
<kwd>OMOP</kwd>
<kwd>OHDSI</kwd>
<kwd>R package</kwd>
<kwd>observational data</kwd>
<kwd>trajectory</kwd>
</kwd-group>
<counts>
<page-count count="16"/>
</counts>
</article-meta>
<notes>
<notes notes-type="competing-interest-statement">
<title>Competing Interest Statement</title><p>The authors have declared no competing interest.</p></notes>
<notes notes-type="financial-disclosure">
<title>Funding Statement</title><p>This work was supported by the Estonian Research Council grants (PRG1095, RITA1/02-96-11), the European Union through the European Regional Development Fund grant EU48684, and the European Social Fund via IT Academy programme. The European Health Data &#x0026; Evidence Network has received funding from the Innovative Medicines Initiative 2 Joint Undertaking (JU) under grant agreement No 806968. The JU receives support from the European Union's Horizon 2020 research and innovation programme and EFPIA.</p></notes>
<notes notes-type="disclosures">
<title>Author Declarations</title><p>I confirm all relevant ethical guidelines have been followed, and any necessary IRB and/or ethics committee approvals have been obtained.</p><p>Yes</p><p>The details of the IRB/oversight body that provided approval or exemption for the research described are given below:</p><p>Eesti bioeetika ja inimuuringute noukogu (EBIN) gave ethical approval for this work (approval 1.1-12/653)</p><p>I confirm that all necessary patient/participant consent has been obtained and the appropriate institutional forms have been archived, and that any patient/participant/sample identifiers included were not known to anyone (e.g., hospital staff, patients or participants themselves) outside the research group so cannot be used to identify individuals.</p><p>Yes</p><p>I understand that all clinical trials and any other prospective interventional studies must be registered with an ICMJE-approved registry, such as ClinicalTrials.gov. I confirm that any such study reported in the manuscript has been registered and the trial registration ID is provided (note: if posting a prospective study registered retrospectively, please provide a statement in the trial ID field explaining why the study was not registered in advance).</p><p>Yes</p><p>I have followed all appropriate research reporting guidelines and uploaded the relevant EQUATOR Network research reporting checklist(s) and other pertinent material as supplementary files, if applicable.</p><p>Yes</p></notes>
</notes>
</front>
<body>
<sec id="s1">
<title>INTRODUCTION</title>
<p>Electronic health records are increasingly used for research. They provide a great opportunity for conducting large-scale studies of different diseases and populations that would not be feasible in classical clinical trials or cohort studies. One topic of interest in recent times has been the identification of temporal disease sequences (trajectories) where one event leads to another. This could not only describe progressions within the population but also predict future illnesses from the existing ones.[<xref ref-type="bibr" rid="c1">1</xref>-<xref ref-type="bibr" rid="c6">6</xref>] An impressive number of temporal relations have been published in trajectory studies, providing a good characterization of these datasets. However, it is difficult to estimate which of these trajectories reflect local healthcare factors such as diagnosis and treatment practices unique to the local or regional healthcare system and which are generalizable globally. In order to find clinically relevant information about disease trajectories that are independent from a particular database and could potentially improve patient care, trajectory studies need to be replicated across a wider database network. The absolute number of disease trajectory studies has remained relatively small. We think this is because of two reasons - first, there is a lack of syntactic and semantic interoperability of health data which makes network studies a challenge, and second, there has not been an open-source standardized implementation of an analytical framework for performing this type of analysis.</p>
<p>The first issue is currently being tackled by various research communities. The open-science Observational Health Data Sciences and Informatics (OHDSI) network has put a tremendous amount of effort into building an open community standard OMOP (Observational Medical Outcomes Partnership) common data model (CDM). OMOP CDM uses standardized vocabulary that transforms data from disparate observational health databases into a common format. This allows the development and wider use of standardized tools for the analysis of electronic medical records regardless of the original formatting of the data.[<xref ref-type="bibr" rid="c7">7</xref>] As of today, it is estimated that observational health data of 810 million distinct patients in over 330 databases are partially mapped to the OMOP model,[<xref ref-type="bibr" rid="c8">8</xref>] and a wide range of studies have already been conducted on these datasets by a large OHDSI community.[<xref ref-type="bibr" rid="c9">9</xref>] Using the same network for investigating temporal health event sequences would enable us to conduct trajectory studies on an unprecedented scale.</p>
<p>Common principles for disease trajectory studies are needed to standardize such studies. We have found that the methods used in previous publications are described insufficiently for adequate replication in other datasets, making it almost impossible to verify the results or conduct a similar analysis in other settings.</p>
<p>In this paper, we propose a standardized framework for detecting prominent temporal clinical event trajectories in the observational health dataset, based on the previous publications and best practices of that field. It is a stepwise process starting with identifying the simplest elements of the trajectories, followed by building longer trajectories of these elements and counting the actual event sequences on that graph. We also introduce the implementation of the framework as open-source software Trajectories that utilizes the OMOP CDM and standardized vocabularies.</p>
</sec>
<sec id="s2">
<title>METHODS</title>
<sec id="s2a">
<title>Framework for detecting temporal health event trajectories</title>
<p>The proposed framework for detecting temporal health event trajectories consists of the following steps (<bold><xref rid="fig1" ref-type="fig">Figure 1</xref></bold>):</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1.</label>
<caption><p>Illustration of the framework.</p></caption>
<graphic xlink:href="21266518v1_fig1.tif"/>
</fig>
<list list-type="order">
<list-item><p>Define a study cohort</p></list-item>
<list-item><p>Specify study parameters</p></list-item>
<list-item><p>Identify temporal clinical event pairs</p></list-item>
<list-item><p>Count trajectories consisting of temporal clinical event pairs</p></list-item>
</list>
</sec>
<sec id="s2b">
<title>Define a study cohort</title>
<p>Depending on the research question, disease trajectories can be investigated either in the whole dataset or within a more specific cohort. For example, one may be interested in revealing specific treatment patterns used within a specific cohort such as Type 2 Diabetes, ignoring clinical events related to any other patient group. Therefore, it is vital to clearly define the study cohort at the beginning of any disease trajectory analysis. In our framework, we use flexible and powerful cohort definition principles from OHDSI/OMOP network, where a cohort is a set of persons who satisfy one or more inclusion criteria for a duration of time.[<xref ref-type="bibr" rid="c10">10</xref>] These principles have been effectively used in a number of studies across the world,[<xref ref-type="bibr" rid="c8">8</xref>,<xref ref-type="bibr" rid="c11">11</xref>] allowing for detailed descriptions of the cohorts by using basically any kind of recorded health information. Note that a full database can also form a cohort. Identifying underlying disease pathways from a full database can discover unknown relationships in individuals and timeframes not excluded by the cohort definition.</p>
</sec>
<sec id="s2c">
<title>Specify study parameters</title>
<p>Within the cohort, there are many additional criteria for the trajectories that need to be specified according to the exact research question.</p>
<p>First, the investigator has to decide which types of clinical events are included in the analysis. While previous trajectory studies have mainly focused on diseases, we extend this approach to any event type that is recorded in observational data. Particularly, a clinical event in the context of our framework is any condition, observation, drug (era), or procedure as determined by the investigator. Within OMOP CDM all the events are coded using standardized OMOP vocabularies.</p>
<p>For discovering ordered temporal sequences where one event leads to another, only the first occurrence of any event for every patient within the cohort is considered, allowing us to avoid counting repeatedly the records with the same (potentially chronic) conditions. This could be a limiting factor for some studies where repetitions of the events play a role - for instance, if one is investigating the sequence of the same type of events or dynamics of numerical measurements associated to same terms. However, taking into account all occurrences of each event when conducting a study is often an impractical approach. For studying diseases that could actually independently occur several times (e.g., seasonal influenza), shorter time frames when defining the cohort should be used allowing the patient to be represented in the cohort with several time periods.</p>
<p>For each patient in the cohort, the selected events form a sequence of events. Any event along that sequence can be considered as a potential risk factor for future events. While some events increase the risk of the future events (relative risk RR&#x003E;1), others may decrease it (RR&#x003C;1). For many event pairs, the effect can be very small (RR close to 1) and provide little practical interest. Therefore, depending on the research question, the investigator can specify the range of relative risk of interest, leaving the event pairs that do not satisfy the RR range criteria out of the analysis.</p>
<p>Finally, there are a few parameters that can be used for fine-tuning the analysis. To focus on the most prevalent event sequences, the investigator can set a minimum prevalence for event pairs in order to include them in the analysis. Sometimes it can be useful to limit the minimum and maximum temporal distance in days between the events, preventing events that are either too close or too far apart to be included in the analysis.</p>
</sec>
<sec id="s2d">
<title>Identify temporal clinical event pairs</title>
<p>Although each individual sequence consists of a number of events, only a few of them have a significant effect on the following events and provide interest for the trajectory studies. The aim of this step is to identify the building blocks for creating longer trajectories. We identify event pairs where the first event tends to not only occur before the other but also alter the risk of the following event. This approach is similar to what has been used by Jensen et al. and Siggaard et al.[<xref ref-type="bibr" rid="c1">1</xref>,<xref ref-type="bibr" rid="c3">3</xref>]</p>
<p>We perform extensive statistical significance testing of event co-occurrence in event sequences. First, events of each individual sequence are arranged into event pairs - every two events occurring in specific order (may have intermediate events between) within a timeframe specified in the study parameters, form an event pair E1 &#x2192; E2. Next, for each pair that satisfies all other study parameters described in the previous section, it is assessed whether the first event alters RR of the following event and whether they have a significant temporal order.</p>
<p>For the first task, an exposed (patients having prior E1) and background group (matched patients from the whole cohort) are composed, and the prevalence of E2 in both groups is assessed. For example, Jensen et al. matched exposed and background groups by gender, age group, type of hospital and week of the E1 occurrence in the Danish dataset.[<xref ref-type="bibr" rid="c1">1</xref>,<xref ref-type="bibr" rid="c3">3</xref>] The number of matching patients will quickly become very small with high levels of stratification, especially for rare events. This would require an initial database of enormous size, as was the case in Denmark.[<xref ref-type="bibr" rid="c1">1</xref>] Therefore, our proposed framework requires exact matching by gender, age group and a year of the occurrence of E1 only. Other components are combined into propensity scores and matched. Next, statistical testing is performed. The framework uses Fisher&#x2019;s exact test to first assess whether the prevalence of E2 in the exposed group is significantly different from the background group.</p>
<p>For all event pairs that demonstrate a significant association, we assess whether there is a significant temporal order (direction) between E1 and E2 in the data using a binomial test (similar to Jensen et al.[<xref ref-type="bibr" rid="c1">1</xref>]).</p>
<p>For both tests, the multiple testing corrected p-value below 0.05 is considered statistically significant. We propose to use the false discovery rate (FDR) correction for discovery studies and the more conservative Bonferroni correction for validation studies.</p>
</sec>
<sec id="s2e">
<title>Count trajectory patterns consisting of temporal clinical event pairs</title>
<p>In the previous step, significant temporal event pairs - the building blocks of longer event trajectories - were identified. These can be further used to form a directed graph where each event is represented as a node and directional edges represent the temporal order between events. The graph is useful for illustrating the main trajectories within the database, especially when less frequent pairs are filtered out (<bold><xref rid="fig2" ref-type="fig">Figure 2</xref></bold>). The significant temporal event pairs are combined into all possible longer trajectories (e.g., E1 &#x2192; E2 and E2 &#x2192; E3, producing the trajectory E1 &#x2192; E2 &#x2192; E3) and their actual occurrences are counted by evaluating them against the database. The process is described in detail by Jensen et al.[<xref ref-type="bibr" rid="c1">1</xref>] As a result, the list of all trajectories together with their occurrence counts is obtained. The list can be later filtered to answer questions such as how many patients have a trajectory from A to B to C.</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2.</label>
<caption><p>Twenty most frequent event pairs in Type 2 Diabetes cohort in Estonian dataset. Node size indicates the number of patients of that event record, relative risk of the future event is shown on edges. All pairs were also validated as significant in the IPCI database.</p></caption>
<graphic xlink:href="21266518v1_fig2.tif"/>
</fig>
</sec>
<sec id="s2f">
<title>Implementation of the clinical event pair detection framework</title>
<p>The framework described above is implemented as an open-source R package freely available in GitHub<sup><xref ref-type="fn" rid="fn1">1</xref></sup>, and is open for the community to add further improvements and additional features in the future. It can be run in two modes - either to discover event trajectories from the dataset without any prior knowledge or to validate the event pairs that were discovered in some other dataset. The only difference is that in the validation mode the exact event pairs for testing are given as input. Detailed information on how to run the R package is described in the vignette located in the repository.</p>
<p>Optimal pair matching was performed using the &#x2018;MatchIt&#x2019; package, which calls functions from the &#x2018;optmatch&#x2019; package.[<xref ref-type="bibr" rid="c12">12</xref>-<xref ref-type="bibr" rid="c13">13</xref>] For large databases, one can also use faster nearest neighbor matching.</p>
<p>We demonstrate the framework and the package by replicating the largest published trajectory study[<xref ref-type="bibr" rid="c3">3</xref>] (Danish population) on Estonian population-based data. In addition, we conducted a Type 2 Diabetes trajectory study on Estonian and Integrated Primary Care Information (IPCI) databases from the Netherlands. The Estonian dataset contains health data of a 10&#x0025; random sample of the Estonian population (n=147K patients). For each individual in the dataset, all insurance claims, digital prescriptions and in- and outpatient electronic health records from the period 2012-2019 were first converted to OMOP CDM. Mortality rates in the dataset are not complete, covering approximately only two thirds of all deaths. IPCI is a Dutch database containing the complete medical record of more than 2.8 million patients provided by more than 450 general practitioners (GP) geographically spread over the Netherlands. In the Netherlands, all citizens are registered with a GP practice which acts as a gatekeeper in a two-way exchange of information with secondary care. The medical records can therefore be assumed to contain all relevant medical information including medical findings and diagnosis from secondary care. The International Classification of Primary Care (ICPC) is the coding system but diagnoses and complaints can also be entered as free text. Prescription data contain information on product name, quantity prescribed, dosage regimens, strength, indication, and ATC codes.</p>
</sec>
</sec>
<sec id="s3">
<title>RESULTS</title>
<sec id="s3a">
<title>Validation of Danish temporal event pairs in the Estonian population</title>
<p>We analyzed 40,711 temporal event pairs reported by Siggaard et al.[<xref ref-type="bibr" rid="c3">3</xref>] as having significant temporal order in the Danish population and tried to confirm or reject these in Estonian data. Both datasets use The International Classification of Diseases version 10 (ICD-10) codes, the Danish dataset being much larger with 7.2 million patients and spanning 24 years (1994-2018). Out of all pairs tested, 13.5&#x0025; did not occur in Estonian data at all (<bold><xref rid="fig3" ref-type="fig">Figure 3</xref></bold>). For instance, code &#x201C;K64&#x201D; (hemorrhoids and perianal venous thrombosis) is one of the events in 147 temporal pairs in Denmark but the code is never used in Estonia. There physicians still record &#x201C;I84&#x201D; instead (Haemorrhoids), although the particular code was removed from ICD-10 in 2010 already.</p>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3.</label>
<caption><p>Process flow of testing Danish directional event pairs in Estonian dataset.</p></caption>
<graphic xlink:href="21266518v1_fig3.tif"/>
</fig>
<p>For the majority of the pairs tested (78.4&#x0025;), RR of the future event was not found significantly different from 1 in Estonia. However, such a high number was not a surprise as the Estonian dataset was 49x smaller in patient count and 3x in the time range. The mean counts of these non-significant pairs were 835 in Danish and 46 in the Estonian dataset. Differences in event frequencies play a role here. For example, code &#x201C;O83&#x201D; (other assisted single delivery) is frequently used in Danish data (n=59,868 patients) and produced 185 significant temporal event pairs as a result (most prevalent pair &#x201C;E66&#x201D; overweight and obesity &#x2192; &#x201C;O83&#x201D; occurred on 10,927 patients). However, in Estonia, the usage of &#x201C;O83&#x201D; is extremely rare (n=12) and only 29 of the pairs tested containing that code occurred at least once which is far from being sufficient for observing any statistical significance.</p>
<p>For many pairs where the preceding event altered the RR of the future event, the direction of the risk (increased or decreased) or the order of the two events was opposite of what had been reported in Denmark (4&#x0025; and 1.7&#x0025; of the cases respectively). All these pairs had an increased risk in the Estonian data, while a decreased effect was reported in Denmark. An extreme example is &#x201C;J35&#x201D; (chronic diseases of tonsils and adenoids) which had a protective effect against future &#x201C;K83&#x201D; (other diseases of biliary tract) in Denmark (RR=0.30) but increases the same risk significantly in Estonia (RR=4.5, 95&#x0025;CI 2.41..8.40).</p>
<p>As a result, we were able to confirm significantly altered RR and temporal order of 976 pairs (2.4&#x0025;) (<bold><xref rid="fig3" ref-type="fig">Figure 3</xref></bold>). All validation results are given in <bold>Supplementary File</bold>.</p>
</sec>
<sec id="s3b">
<title>Discovering event pairs in Estonian data</title>
<p>To discover all temporal event pairs in Estonian data, we ran our package on the whole data without any prior knowledge of Danish findings. We used similar parameters to get comparable results (required pair count &#x003E;=20). In total, 130,137 event pairs were tested in the Estonian dataset. Out of these, 22,618 pairs in between 797 individual events were found directional and significant (<bold><xref rid="fig4" ref-type="fig">Figure 4</xref></bold>), but only 4937 pairs of them (22&#x0025;) overlapped with the Danish directional pairs. What is more, for 2290 pairs (10&#x0025;), the effect direction of the first event of the pair was similar to the Danish study.</p>
<fig id="fig4" position="float" fig-type="figure">
<label>Figure 4.</label>
<caption><p>Attrition diagram of identifying directional event pairs in Estonian dataset.</p></caption>
<graphic xlink:href="21266518v1_fig4.tif"/>
</fig>
<p>Again, differences in the frequencies of the ICD-10 codes play an important role here (<bold><xref rid="fig5" ref-type="fig">Figure 5</xref></bold>). For example, code &#x201C;J06&#x201D; (acute upper respiratory infections of multiple and unspecified sites) is extensively used in Estonia - recorded for 36&#x0025; of the patients - leading to 432 temporal event pairs containing &#x201C;J06&#x201D; either as the first or the second event. In contrast, only 1.2&#x0025; of Danish people have a &#x201C;J06&#x201D; record and just 15 temporal event pairs are found. Another example is &#x201C;I11&#x201D; (hypertensive heart disease) which has a frequency in Estonia 24&#x0025; vs. 0.5&#x0025; in Denmark and temporal pair counts 425 vs. 44. Such big discrepancies in individual codes may immediately affect many temporal pairs of events.</p>
<fig id="fig5" position="float" fig-type="figure">
<label>Figure 5.</label>
<caption><p>Event frequency is correlated with the number of identified significant event pairs (example on Estonian data). Diagnosis codes mentioned in this paper are highlighted.</p></caption>
<graphic xlink:href="21266518v1_fig5.tif"/>
</fig>
<p>All tested and discovered event pairs are given in <bold>Supplementary File</bold>. For privacy reasons, event counts less than 20 are hidden.</p>
</sec>
<sec id="s3c">
<title>Type 2 Diabetes event trajectories in Estonia and IPCI</title>
<p>To illustrate a cohort-based approach, we ran a discovery study of event trajectories for Type 2 Diabetes (T2D) cohort in the Estonian database (n=11,009 patients) to identify temporal event pairs that occur in at least 1&#x0025; of the cohort and where the preceding event increases the risk of the second one at least 1.2 times. The discovery run on Estonian data revealed 943 significant event pairs. To validate the findings, we ran a validation study of these pairs on an independent IPCI database from the Netherlands. The validation confirmed 177 of the tested pairs (19&#x0025;) while 61&#x0025; of the pairs never occurred in the IPCI database, highlighting the issue of different source codes and/or OMOP CDM mappings used in these databases. In particular, IPCI uses ICPC coding system while Estonian data is based on ICD-10. The latter differentiates T2D with and without complication whereas the IPCI database has a single source code for both conditions (&#x201C;Type 2 diabetes mellitus&#x201D;). Therefore, pairs with &#x201C;Type 2 diabetes mellitus without complication&#x201D; do not occur there at all. This of course alters the RR values - in IPCI, the sole T2D diagnosis code increases the risk of future metformin 32 times (95&#x0025;CI 28..37) while in Estonia the risk is much smaller (RR=2.8) as there are other T2D diagnosis codes that precede metformin treatment.</p>
<p>As expected, &#x201C;Type 2 diabetes mellitus&#x201D; &#x2192; &#x201C;metformin&#x201D; is the most prevalent trajectory within Estonian data as metformin is the main medication for T2D. Out of longer trajectories, &#x201C;Essential hypertension&#x201D; &#x2192; &#x201C;Type 2 diabetes mellitus&#x201D; &#x2192; &#x201C;metformin&#x201D; is the second most prevalent one. This is a somewhat expected result as high blood pressure is a previously shown risk factor for diabetes, especially when the blood pressure is uncontrolled while the order of these conditions also varies in different studies.[<xref ref-type="bibr" rid="c14">14</xref>-<xref ref-type="bibr" rid="c18">18</xref>] The first most prevalent three-event trajectory is &#x201C;Type 2 diabetes mellitus&#x201D; &#x2192; &#x201C;metformin&#x201D; &#x2192; &#x201C;metoprolol&#x201D;, supporting the recent findings of T2D being likely causal to hypertension.[<xref ref-type="bibr" rid="c18">18</xref>] T2D damages blood vessels and increases the risk of various cardiovascular diseases,[<xref ref-type="bibr" rid="c19">19</xref>] for which metoprolol was the first-line treatment until 2019 in Estonia. In the Netherlands, the most prevalent trajectory is &#x201C;Cystitis&#x201D; &#x2192; &#x201C;Urinary tract infectious disease&#x201D;, supporting the previous findings that infectious diseases, including cystitis, are more prevalent among T2D patients when compared to others.[<xref ref-type="bibr" rid="c20">20</xref>]</p>
<p>All confirmed event pairs of this study, as well as the trajectories with their counts in the Estonian dataset, are given in <bold>Supplementary File</bold>. These pairs are also available as a built-in preset in the Trajectories package so that everyone can validate those on their own database with only a few clicks. The twenty most frequent pairs are shown in <bold><xref rid="fig2" ref-type="fig">Figure 2</xref></bold>.</p>
</sec>
</sec>
<sec id="s4">
<title>DISCUSSION</title>
<p>In this paper, we have introduced a framework and implemented an open-source software for detecting event trajectories in OMOP-formatted health data. We evaluated the framework by replicating a Danish study to identify all significant event pairs in Estonia and also conducted a Type 2 Diabetes study on two different datasets.</p>
<p>It can be seen from the results that differences in the frequencies of used event concepts (codes) play an important role in trajectory analysis. There is a strong correlation between the frequency of the event and the number of significant temporal event pairs containing that event (correlation coefficient is 0.88 in Estonia and approximately 0.99 in Denmark<sup><xref ref-type="fn" rid="fn2">2</xref></sup>). Therefore, when the baseline frequencies vary in different datasets or populations, we will get different sets of significant event pairs. The reasons behind these variations in frequencies can be attributed to several factors. First, the true prevalence of the diseases can be different in different populations or data sets. Second, as we saw above, different concepts can be used in different cultures or healthcare environments to record the same underlying condition. Third, differences in source coding systems and their granularity lead to different mappings and concepts used in OMOP CDM, making them challenging to compare across several databases.[<xref ref-type="bibr" rid="c21">21</xref>] If concepts were automatically generalized at a higher level, we might be able to replicate findings more effectively. This would not only resolve the problem of using different concepts but also the issue of low statistical power as the numbers in the case of generalized concepts would be higher. However, as OMOP CDM uses SNOMED Clinical Terms ontology as the underlying vocabulary, moving upwards towards the root of the ontology is a challenging task due to the multiple parent concept principle. Finally, the time span of the dataset also has its implications - the longer the observation period, the more conditions occur (such as chronic diseases or deaths, for example), increasing the frequencies of the events and leading to more event pairs with these events as a result. On the other hand, the longer the observation periods grow, the more age-dependent temporal relationships we can start observing in the data.</p>
<p>Another aspect that needs to be kept in mind is that event trajectories happening in the data and picked up by the software package may not be causative. For instance, confounding effects can cause spurious associations, and it is not easy to distinguish them from the causative event trajectories. The proposed framework does not yet contain any causality checks and the results characterize only the associations in the dataset. However, the findings could be used as hypotheses for further causality studies.</p>
<p>One of the weaknesses of the package is that in its current approach, it is limited to discrete or binary events only. Future extensions of the framework can also include numerical values such as laboratory measurements as events.</p>
<p>There are a number of strengths to our approach as well. While following the principles of previously published studies, it is to our best knowledge the first open-source analysis package for investigating clinical event trajectories. Anyone can now use, examine, validate and modify it as the source code is publicly available. It can be automatically run on any database in OMOP format, not only to characterize the data via trajectories but also to validate event pairs from other studies. The package is not limited to disease codes only as it considers other health-related events such as drug exposures, observations, and procedures, also. The whole analysis process is implemented in a single software package, making each step transparent, and as a whole, stands as a basis for reproducible science. We believe this package can greatly boost scientific studies on the analysis of temporal health events globally and will open new avenues for extending it with additional features in the future.</p>
<p>In the <bold>Supplementary File</bold>, we publish event pairs and disease trajectories from the Estonian population. These can be used as comparison data for any population-level trajectory study in the future.</p>
<p>Finally, we aimed to compare our package results to the output of another disease trajectory tool, recently published by Giannoula et al.[<xref ref-type="bibr" rid="c4">4</xref>] This tool detects temporal event pairs and then clusters the trajectories using a dynamic time warping algorithm. To perform the clustering, ICD-9 codes are used. As our dataset does not use ICD-9 codes in OMOP data, we tried to compare only the event pairs detected from both tools. We found the guidelines for using the tool insufficient as we were not able to run the scripts without altering them. Part of the analysis was also missing, such as the code for calculating RR. Attempts to contact the authors have been unsuccessful and therefore, we were unable to compare the performance of these tools. We think this clearly illustrates why open-source pipelines are important.</p>
</sec>
<sec id="s5">
<title>CONCLUSION</title>
<p>The proposed framework allows for the identification of significant clinical event progression patterns in health data standardized to the OMOP CDM. We have implemented all of this as an easy-to-use R package Trajectories that enables users to extract and visualize temporal event trajectories from OMOP-formatted observational health data and compare the results across databases.</p>
</sec>
<sec sec-type="supplementary-material">
<title>Supporting information</title>
<supplementary-material>
<label>Supplementary File</label>
<media xlink:href="supplements/266518_file02.zip" />
</supplementary-material>
</sec>
</body>
<back>
<sec sec-type="data-availability">
<title>Data Availability</title>
<p>All data produced in the present work are contained in the manuscript and supplementary material</p>
</sec>
<ack>
<title>ACKNOWLEDGEMENTS</title>
<p>This work was supported by the Estonian Research Council grants (PRG1095, RITA1/02-96-11); the European Union through the European Regional Development Fund grant EU48684; and the European Social Fund via IT Academy programme. The European Health Data &#x0026; Evidence Network has received funding from the Innovative Medicines Initiative 2 Joint Undertaking (JU) under grant agreement No 806968. The JU receives support from the European Union&#x2019;s Horizon 2020 research and innovation programme and EFPIA. We would like to thank Marianna Laht for her great support when providing medical know-how for explaining the results.</p>
</ack>
<ref-list>
<title>REFERENCES</title>
<ref id="c1"><label>1</label><mixed-citation publication-type="journal"><string-name><surname>Jensen</surname> <given-names>AB</given-names></string-name>, <string-name><surname>Moseley</surname> <given-names>PL</given-names></string-name>, <string-name><surname>Oprea</surname> <given-names>TI</given-names></string-name>, <etal>et al.</etal> <article-title>Temporal disease trajectories condensed from population-wide registry data covering 6.2 million patients</article-title>. <source>Nature Communications</source> <year>2014</year>;<volume>5</volume>(<issue>1</issue>):<fpage>4022</fpage>.</mixed-citation></ref>
<ref id="c2"><label>2</label><mixed-citation publication-type="journal"><string-name><surname>Hu</surname> <given-names>JX</given-names></string-name>, <string-name><surname>Helleberg</surname> <given-names>M</given-names></string-name>, <string-name><surname>Jensen</surname> <given-names>AB</given-names></string-name>, <etal>et al.</etal> <article-title>A Large-Cohort, Longitudinal Study Determines Precancer Disease Routes across Different Cancer Types</article-title>. <source>Cancer Res</source> <year>2019</year>;<volume>79</volume>(<issue>4</issue>):<fpage>864</fpage>&#x2013;<lpage>72</lpage>.</mixed-citation></ref>
<ref id="c3"><label>3</label><mixed-citation publication-type="journal"><string-name><surname>Siggaard</surname> <given-names>T</given-names></string-name>, <string-name><surname>Reguant</surname> <given-names>R</given-names></string-name>, <string-name><surname>J&#x00F8;rgensen</surname> <given-names>IF</given-names></string-name>, <etal>et al.</etal> <article-title>Disease trajectory browser for exploring temporal, population-wide disease progression patterns in 7.2 million Danish patients</article-title>. <source>Nature Communications</source> <year>2020</year>;<volume>11</volume>(<issue>1</issue>):<fpage>4952</fpage>.</mixed-citation></ref>
<ref id="c4"><label>4</label><mixed-citation publication-type="journal"><string-name><surname>Giannoula</surname> <given-names>A</given-names></string-name>, <string-name><surname>Centeno</surname> <given-names>E</given-names></string-name>, <string-name><surname>Mayer</surname> <given-names>MA</given-names></string-name>, <etal>et al.</etal> <article-title>A system-level analysis of patient disease trajectories based on clinical, phenotypic and molecular similarities</article-title>. <source>Bioinformatics</source> <year>2021</year>;<volume>37</volume>(<issue>10</issue>):<fpage>1435</fpage>&#x2013;<lpage>43</lpage>.</mixed-citation></ref>
<ref id="c5"><label>5</label><mixed-citation publication-type="other"><string-name><surname>Wongsuphasawat</surname> <given-names>K</given-names></string-name>, <string-name><surname>Guerra G&#x00F3;mez</surname> <given-names>JA</given-names></string-name>, <string-name><surname>Plaisant</surname> <given-names>C</given-names></string-name>, <etal>et al.</etal> <article-title>LifeFlow: visualizing an overview of event sequences</article-title>. <source>Proceedings of the SIGCHI conference on human factors in computing systems</source> <year>2011</year>:<fpage>1747</fpage>&#x2013;<lpage>1756</lpage>.</mixed-citation></ref>
<ref id="c6"><label>6</label><mixed-citation publication-type="journal"><string-name><surname>Monroe</surname> <given-names>M</given-names></string-name>, <string-name><surname>Lan</surname> <given-names>R</given-names></string-name>, <string-name><surname>Lee</surname> <given-names>H</given-names></string-name>, <etal>et al.</etal> <article-title>Temporal event sequence simplification</article-title>. <source>IEEE transactions on visualization and computer graphics</source> <year>2013</year>;<volume>19</volume>(<issue>12</issue>):<fpage>2227</fpage>&#x2013;<lpage>36</lpage>.</mixed-citation></ref>
<ref id="c7"><label>7</label><mixed-citation publication-type="website"><collab>Observational Health Data Sciences and Informatics</collab>. <source>The Book of OHDSI</source>. <ext-link ext-link-type="uri" xlink:href="https://ohdsi.github.io/TheBookOfOhdsi/">https://ohdsi.github.io/TheBookOfOhdsi/</ext-link> Access date: <date-in-citation content-type="access-date">Nov 2021</date-in-citation></mixed-citation></ref>
<ref id="c8"><label>8</label><mixed-citation publication-type="website"><string-name><surname>Sachson</surname> <given-names>C</given-names></string-name>, <string-name><surname>Ryan</surname> <given-names>P</given-names></string-name>, <string-name><surname>Kostka</surname> <given-names>K</given-names></string-name>, <etal>et al.</etal> <article-title>Our journey</article-title>. <source>Where The OHDSI Community Has Been And Where We Are Going</source>. <ext-link ext-link-type="uri" xlink:href="https://www.ohdsi.org/wp-content/uploads/2021/09/OHDSI-Book2021-Final.pdf">https://www.ohdsi.org/wp-content/uploads/2021/09/OHDSI-Book2021-Final.pdf</ext-link> Access <date-in-citation content-type="access-date">date: Nov 2021</date-in-citation></mixed-citation></ref>
<ref id="c9"><label>9</label><mixed-citation publication-type="journal"><string-name><surname>Chandran</surname> <given-names>U</given-names></string-name>, <string-name><surname>Reps</surname> <given-names>J</given-names></string-name>, <string-name><surname>Stang</surname> <given-names>PE</given-names></string-name>, <etal>et al.</etal> <article-title>Inferring disease severity in rheumatoid arthritis using predictive modeling in administrative claims databases</article-title>. <source>PLOS ONE</source> <year>2019</year>;<volume>14</volume>(<issue>12</issue>):<fpage>e0226255</fpage>.</mixed-citation></ref>
<ref id="c10"><label>10</label><mixed-citation publication-type="journal"><string-name><surname>Reps</surname> <given-names>JM</given-names></string-name>, <string-name><surname>Schuemie</surname> <given-names>MJ</given-names></string-name>, <string-name><surname>Suchard</surname> <given-names>MA</given-names></string-name>, <etal>et al.</etal> <article-title>Design and implementation of a standardized framework to generate and evaluate patient-level prediction models using observational healthcare data</article-title>. <source>Journal of the American Medical Informatics Association</source> <year>2018</year>;<volume>25</volume>(<issue>8</issue>):<fpage>969</fpage>&#x2013;<lpage>75</lpage>.</mixed-citation></ref>
<ref id="c11"><label>11</label><mixed-citation publication-type="journal"><string-name><surname>Li</surname> <given-names>X</given-names></string-name>, <string-name><surname>Ostropolets</surname> <given-names>A</given-names></string-name>, <string-name><surname>Makadia</surname> <given-names>R</given-names></string-name>, <etal>et al.</etal> <article-title>Characterising the background incidence rates of adverse events of special interest for covid-19 vaccines in eight countries: multinational network cohort study</article-title>. <source>bmj</source> <year>2021</year>;<volume>373</volume>.</mixed-citation></ref>
<ref id="c12"><label>12</label><mixed-citation publication-type="other"><string-name><surname>Stuart</surname> <given-names>EA</given-names></string-name>, <string-name><surname>King</surname> <given-names>G</given-names></string-name>, <string-name><surname>Imai</surname> <given-names>K</given-names></string-name>, <etal>et al.</etal> <article-title>MatchIt: nonparametric preprocessing for parametric causal inference</article-title>. <source>Journal of statistical software</source> <year>2011</year>.</mixed-citation></ref>
<ref id="c13"><label>13</label><mixed-citation publication-type="journal"><string-name><surname>Hansen</surname> <given-names>BB</given-names></string-name>, <string-name><surname>Klopfer</surname> <given-names>SO</given-names></string-name>. <article-title>Optimal full matching and related designs via network flows</article-title>. <source>Journal of computational and Graphical Statistics</source> <year>2006</year>;<volume>15</volume>(<issue>3</issue>):<fpage>609</fpage>&#x2013;<lpage>27</lpage>.</mixed-citation></ref>
<ref id="c14"><label>14</label><mixed-citation publication-type="journal"><string-name><surname>Gress</surname> <given-names>TW</given-names></string-name>, <string-name><surname>Nieto</surname> <given-names>FJ</given-names></string-name>, <string-name><surname>Shahar</surname> <given-names>E</given-names></string-name>, <etal>et al.</etal> <article-title>Hypertension and antihypertensive therapy as risk factors for type 2 diabetes mellitus</article-title>. <source>New England Journal of Medicine</source>. <year>2000</year>;<volume>342</volume>(<issue>13</issue>):<fpage>905</fpage>&#x2013;<lpage>12</lpage>.</mixed-citation></ref>
<ref id="c15"><label>15</label><mixed-citation publication-type="journal"><string-name><surname>Izzo</surname> <given-names>R</given-names></string-name>, <string-name><surname>De Simone</surname> <given-names>G</given-names></string-name>, <string-name><surname>Chinali</surname> <given-names>M</given-names></string-name>, <etal>et al.</etal> <article-title>Insufficient control of blood pressure and incident diabetes</article-title>. <source>Diabetes Care</source> <year>2009</year>;<volume>32</volume>(<issue>5</issue>):<fpage>845</fpage>&#x2013;<lpage>50</lpage>.</mixed-citation></ref>
<ref id="c16"><label>16</label><mixed-citation publication-type="journal"><string-name><surname>Kim</surname> <given-names>MJ</given-names></string-name>, <string-name><surname>Lim</surname> <given-names>NK</given-names></string-name>, <string-name><surname>Choi</surname> <given-names>SJ</given-names></string-name>, <etal>et al.</etal> <article-title>Hypertension is an independent risk factor for type 2 diabetes: the Korean genome and epidemiology study</article-title>. <source>Hypertension Research</source> <year>2015</year>;<volume>38</volume>(<issue>11</issue>):<fpage>783</fpage>&#x2013;<lpage>9</lpage>.</mixed-citation></ref>
<ref id="c17"><label>17</label><mixed-citation publication-type="journal"><string-name><surname>Horr</surname> <given-names>S</given-names></string-name>, <string-name><surname>Nissen</surname> <given-names>S.</given-names></string-name> <article-title>Managing hypertension in type 2 diabetes mellitus</article-title>. <source>Best practice &#x0026; research Clinical endocrinology &#x0026; metabolism</source> <year>2016</year>;<volume>30</volume>(<issue>3</issue>):<fpage>445</fpage>&#x2013;<lpage>54</lpage>.</mixed-citation></ref>
<ref id="c18"><label>18</label><mixed-citation publication-type="journal"><string-name><surname>Sun</surname> <given-names>D</given-names></string-name>, <string-name><surname>Zhou</surname> <given-names>T</given-names></string-name>, <string-name><surname>Heianza</surname> <given-names>Y</given-names></string-name>, <etal>et al.</etal> <article-title>Type 2 diabetes and hypertension: a study on bidirectional causality</article-title>. <source>Circulation research</source> <year>2019</year>;<volume>124</volume>(<issue>6</issue>):<fpage>930</fpage>&#x2013;<lpage>7</lpage>.</mixed-citation></ref>
<ref id="c19"><label>19</label><mixed-citation publication-type="journal"><string-name><surname>Zhang</surname> <given-names>R</given-names></string-name>, <string-name><surname>Mamza</surname> <given-names>J</given-names></string-name>, <string-name><surname>Morris</surname> <given-names>T</given-names></string-name>, <etal>et al.</etal> <article-title>Lifetime risk of cardiovascular-renal disease in type 2 diabetes: a population-based study in 473399 individuals</article-title>. <source>European Heart Journal</source> <year>2020</year>;<volume>41</volume>(<issue>Supplement_2</issue>):<fpage>ehaa946</fpage>&#x2013;<lpage>3313</lpage>.</mixed-citation></ref>
<ref id="c20"><label>20</label><mixed-citation publication-type="journal"><string-name><surname>Shah</surname> <given-names>BR</given-names></string-name>, <string-name><surname>Hux</surname> <given-names>JE</given-names></string-name>. <article-title>Quantifying the risk of infectious diseases for people with diabetes</article-title>. <source>Diabetes care</source> <year>2003</year>;<volume>26</volume>(<issue>2</issue>):<fpage>510</fpage>&#x2013;<lpage>3</lpage>.</mixed-citation></ref>
<ref id="c21"><label>21</label><mixed-citation publication-type="journal"><string-name><surname>Ostropolets</surname> <given-names>A</given-names></string-name>, <string-name><surname>Reich</surname> <given-names>C</given-names></string-name>, <string-name><surname>Ryan</surname> <given-names>P</given-names></string-name>, <etal>et al.</etal> <article-title>Characterizing database granularity using SNOMED-CT hierarchy</article-title>. <source>AMIA Annu Symp Proc</source>. <year>2021</year>;<volume>2020</volume>:<fpage>983</fpage>&#x2013;<lpage>992</lpage>.</mixed-citation></ref>
</ref-list>
<sec id="s6">
<title>SUPPLEMENTARY DATA</title>
<p>Supplementary File (zip) contains:</p>
<list list-type="bullet">
<list-item><p>Supplementary Description &#x2013; Description of Data tables (Supplementary Files 2-4)</p></list-item>
<list-item><p>Supplementary Files 2-4 &#x2013; Data tables</p></list-item>
</list>
</sec>
<fn-group>
<fn id="fn1">
<label><sup>1</sup></label>
<p><ext-link ext-link-type="uri" xlink:href="https://github.com/EHDEN/Trajectories">https://github.com/EHDEN/Trajectories</ext-link></p></fn>
<fn id="fn2">
<label><sup>2</sup></label>
<p>Based on 10 random pairs as the exact counts are not published</p></fn>
</fn-group>
</back>
</article>