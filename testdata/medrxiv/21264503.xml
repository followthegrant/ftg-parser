<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2d1 20170631//EN" "JATS-archivearticle1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="article" dtd-version="1.2d1" specific-use="production" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">MEDRXIV</journal-id>
<journal-title-group>
<journal-title>medRxiv</journal-title>
<abbrev-journal-title abbrev-type="publisher">medRxiv</abbrev-journal-title>
</journal-title-group>
<publisher>
<publisher-name>Cold Spring Harbor Laboratory</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1101/2021.10.07.21264503</article-id>
<article-version>1.1</article-version>
<article-categories>
<subj-group subj-group-type="hwp-journal-coll">
<subject>Health Informatics</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Solving the &#x201C;right&#x201D; problems for effective machine learning driven in vitro fertilization</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name><surname>Erlich</surname><given-names>Itay</given-names></name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<name><surname>Ben-Meir</surname><given-names>Assaf</given-names></name>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author">
<name><surname>Har-Vardi</surname><given-names>Iris</given-names></name>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="aff" rid="a4">4</xref>
</contrib>
<contrib contrib-type="author">
<name><surname>Grifo</surname><given-names>James A.</given-names></name>
<xref ref-type="aff" rid="a5">5</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1477-5478</contrib-id>
<name><surname>Zaritsky</surname><given-names>Assaf</given-names></name>
<xref ref-type="aff" rid="a6">6</xref>
<xref ref-type="corresp" rid="cor1">&#x002A;</xref>
</contrib>
<aff id="a1"><label>1</label><institution>The Alexander Grass Center for Bioengineering, School of Computer Science and Engineering, Hebrew University of Jerusalem</institution>, <country>Israel</country></aff>
<aff id="a2"><label>2</label><institution>Fairtilty Ltd.</institution>, Tel Aviv, <country>Israel</country></aff>
<aff id="a3"><label>3</label><institution>Fertility and IVF unit, Department of Obstetrics and Gynecology, Hadassah Medical Center and Faculty of Medicine, Hebrew University of Jerusalem</institution>, <country>Israel</country></aff>
<aff id="a4"><label>4</label><institution>Fertility and IVF unit, Department of Obstetrics and Gynecology, Soroka University Medical Center and the Faculty of Health Sciences, Ben-Gurion University of the Negev</institution>, Beer-Sheva, <country>Israel</country></aff>
<aff id="a5"><label>5</label><institution>New York University Langone Prelude Fertility Center</institution>, New York, New York</aff>
<aff id="a6"><label>6</label><institution>Department of Software and Information Systems Engineering, Ben-Gurion University of the Negev</institution>, Beer-Sheva 84105, <country>Israel</country></aff>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>&#x002A;</label>Corresponding author: Assaf Zaritsky, <email>assafza@bgu.ac.il</email></corresp>
</author-notes>
<pub-date pub-type="epub">
<year>2021</year>
</pub-date>
<elocation-id>2021.10.07.21264503</elocation-id>
<history>
<date date-type="received">
<day>07</day>
<month>10</month>
<year>2021</year>
</date>
<date date-type="rev-recd">
<day>07</day>
<month>10</month>
<year>2021</year>
</date>
<date date-type="accepted">
<day>07</day>
<month>10</month>
<year>2021</year>
</date>
</history>
<permissions>
<copyright-statement>&#x00A9; 2021, Posted by Cold Spring Harbor Laboratory</copyright-statement>
<copyright-year>2021</copyright-year>
<license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This pre-print is available under a Creative Commons License (Attribution 4.0 International), CC BY 4.0, as described at <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p></license>
</permissions>
<self-uri xlink:href="21264503.pdf" content-type="pdf" xlink:role="full-text"/>
<abstract>
<title>Abstract</title>
<p>Automated live embryo imaging has transformed in-vitro fertilization (IVF) into a data-intensive field. Unlike clinicians who rank embryos from the same IVF cycle cohort based on the embryos visual quality and determine how many embryos to transfer based on clinical factors, machine learning solutions usually combine these steps by optimizing for implantation prediction and using the same model for ranking the embryos within a cohort. Here we establish that this strategy can lead to sub-optimal selection of embryos. We reveal that despite enhancing implantation prediction, inclusion of clinical properties hampers ranking. Moreover, we find that ambiguous labels of failed implantations, due to either low quality embryos or poor clinical factors, confound both the optimal ranking and even implantation prediction. To overcome these limitations, we propose conceptual and practical steps to enhance machine-learning driven IVF solutions. These consist of separating the optimizing of implantation from ranking by focusing on visual properties for ranking, and reducing label ambiguity.</p><sec>
<title>Lay Summary</title>
<sec>
<title>Background</title>
<p>In vitro fertilization (IVF) is the process where a cohort of embryos are developed in a laboratory followed by selecting a few to transfer in the patient&#x2019;s uterus. After approximately forty years of low-throughput, automated live embryo imaging has transformed IVF into a data-intensive field leading to the development of unbiased and automated methods that rely on machine learning for embryo assessment. These advances are now revolutionizing the field with recent retrospective papers demonstrating computational models comparable and even exceeding clinicians&#x2019; performance, startups and medical companies are securing significant funds and at advanced stages of regulatory approvals. Traditionally, embryo selection is performed by clinicians ranking cohort embryos based solely on their visual qualities to estimate implantation potential, and then using non-visual clinical properties that are common to all cohort embryos to decide how many embryos to transfer. Machine learning solutions usually combine these two steps by optimizing for implantation prediction and using the same model for ranking the embryos within a cohort under the implicit assumption that training to predict implantation potential also optimizes a solution to the problem of ranking embryos from a specific cohort.</p></sec>
<sec>
<title>Results</title>
<p>In this multi-center retrospective study we analyzed over 48,000 live imaged embryos to provide evidence that the common machine-learning scheme of training a model to predict implantation and using the same model for embryo ranking is wrong. We made this point by explicitly decoupling the problems of embryo implantation prediction and ranking with a set of computational analyses. We demonstrated that: (1) Using clinical cohort-related information (oocyte age) improves embryo implantation prediction but deteriorates ranking, and that (2) The label ambiguity of the embryos that failed to implant (it is not known whether the embryo or the external factors were the reason for failure) deteriorates embryo ranking and even the ability to accurately predict implantation. Our study provides a quantitative mapping of the tradeoffs between data volume, label ambiguity and embryo quality. In a key result, we reveal that considering embryos that were excluded based on their poor visual appearance (called discarded embryos), although commonly thought as trivially discriminated from high quality embryos, enhances embryo ranking by reducing the ambiguity in their (negative) labels. These results establish the benefit of harnessing the availability of extensive data and reliable labels in discarded embryos to improve embryo ranking and implantation prediction.</p></sec>
<sec>
<title>Outlook</title>
<p>We make two practical recommendations for devising machine learning solutions to embryo selection that will open the door for future advancements by data scientists and IVF technology developers. Namely, training models for embryo ranking should: (1) focus exclusively on embryo intrinsic features. (2) include less ambiguous negative labels, such as discarded embryos. In the era of machine learning, these guidelines will shift back the traditional two-step process of optimizing embryo ranking and implantation prediction independently under the appropriate assumptions - an approach better reflecting the clinician&#x2019;s decision that involves the evaluation of all the embryos in the context of its cohort.</p></sec>
</sec>
</abstract>
<counts>
<page-count count="42"/>
</counts>
</article-meta>
<notes>
<notes notes-type="competing-interest-statement">
<title>Competing Interest Statement</title><p>IE, ABM and IHV are employees at Fairtility LTD. AZ is collaborating with AIVF LTD on projects not related to this study.</p></notes>
<notes notes-type="financial-disclosure">
<title>Funding Statement</title><p>This research was supported by the Israel Council for Higher Education (CHE) via the Data Science Research Center, Ben-Gurion University of the Negev, Israel, by the Israel Science Foundation (grant No. 2516/21) and by the Welcome Leap Delta Tissue program (to AZ).</p></notes>
<notes notes-type="disclosures">
<title>Author Declarations</title><p>I confirm all relevant ethical guidelines have been followed, and any necessary IRB and/or ethics committee approvals have been obtained.</p><p>Yes</p><p>The details of the IRB/oversight body that provided approval or exemption for the research described are given below:</p><p>Human embryo image/video data collected from patients were used in this study with institutional review board approval from the Investigation Review Board of Hadassah Hebrew University Medical Center (IRB# HMO-006-20)</p><p>I confirm that all necessary patient/participant consent has been obtained and the appropriate institutional forms have been archived, and that any patient/participant/sample identifiers included were not known to anyone (e.g., hospital staff, patients or participants themselves) outside the research group so cannot be used to identify individuals.</p><p>Yes</p><p>I understand that all clinical trials and any other prospective interventional studies must be registered with an ICMJE-approved registry, such as ClinicalTrials.gov. I confirm that any such study reported in the manuscript has been registered and the trial registration ID is provided (note: if posting a prospective study registered retrospectively, please provide a statement in the trial ID field explaining why the study was not registered in advance).</p><p>Yes</p><p>I have followed all appropriate research reporting guidelines and uploaded the relevant EQUATOR Network research reporting checklist(s) and other pertinent material as supplementary files, if applicable.</p><p>Yes</p></notes>
</notes>
</front>
<body>
<sec id="s1">
<title>Introduction</title>
<p>One of the major challenges in achieving effective in vitro fertilization (IVF) is selecting the specific embryos for implantation from a cohort of &#x201C;sibling&#x201D; embryos from the same IVF cycle [<xref ref-type="bibr" rid="c1">1</xref>, <xref ref-type="bibr" rid="c2">2</xref>]. The decision as to how many and which embryos to implant back to the uterus is driven by the goal of achieving the birth of exactly one healthy baby [<xref ref-type="bibr" rid="c3">3</xref>, <xref ref-type="bibr" rid="c4">4</xref>]. Toward this goal, clinicians score the visual properties of the developing embryos, alongside non-visual clinical parameters that are common to all the embryos from the same cohort, such as previous IVF outcomes, oocyte age and underweight/obesity to estimate the probability of a successful implantation and use these parameters to decide how many and which embryos to implant [<xref ref-type="bibr" rid="c2">2</xref>, <xref ref-type="bibr" rid="c5">5</xref>, <xref ref-type="bibr" rid="c6">6</xref>, <xref ref-type="bibr" rid="c7">7</xref>, <xref ref-type="bibr" rid="c8">8</xref>] (<xref rid="fig1" ref-type="fig">Fig. 1A</xref>). Traditionally, embryo grading and selection are subjectively performed in a two-step process where clinicians first rank cohort embryos based solely on their visual qualities, as a proxy for embryo implantation potential, and then use non-visual clinical properties as a proxy for the embryo-extrinsic factors involved in implantation, to decide how many embryos to transfer [<xref ref-type="bibr" rid="c9">9</xref>, <xref ref-type="bibr" rid="c7">7</xref>]. Recent advances in automated imaging and computation have led to objective and systematic data-driven approaches for embryo evaluation, where machine learning models are trained to output a score that predicts implantation potential [<xref ref-type="bibr" rid="c10">10</xref>, <xref ref-type="bibr" rid="c11">11</xref>, <xref ref-type="bibr" rid="c12">12</xref>, <xref ref-type="bibr" rid="c13">13</xref>, <xref ref-type="bibr" rid="c14">14</xref>, <xref ref-type="bibr" rid="c15">15</xref>, <xref ref-type="bibr" rid="c16">16</xref>]. These scores are then used to rank the embryos in an IVF cycle cohort and assist the clinician in making decisions regarding which embryos should be transferred. This approach of first using massive datasets to train a classifier that predicts retrospective implantation outcomes, and then using its prediction to rank embryos for transfer is performed under the implicit premise that a model trained to predict implantation potential is suitable for ranking embryos from a specific cycle cohort.</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1:</label>
<caption><p>Decoupling embryo scoring and ranking using intrinsic and extrinsic features. (<bold>A</bold>) Embryo implantation potential relies on the embryo&#x2019;s visual and clinical properties. (<bold>B</bold>) Distribution of implanted (KID-P) versus non-implanted (KID-N) embryos according to oocyte age. The average oocyte age of the KID-P (KID-N) embryos was 32.82 (36.74) with a standard deviation of 4.93 (6.33). N KID-P = 1694, N KID-N = 7122. (<bold>C-D</bold>) Comparison of the implantation prediction performance (AUC) of models trained with or without the oocyte age over time since fertilization. (<bold>C</bold>) Embryo morphological features (marked with an embryo image). (<bold>D</bold>) Embryo morphokinetic features (marked with &#x201C;T&#x201D;). (<bold>E</bold>) Comparing implantation prediction performance: the morphology-based classifier outperformed morphokinetic-based classifier but morphokinetic and oocyte age outperformed morphology and oocyte age. (<bold>F</bold>) Correlation between the temporal derivative of the morphology-based classification with and without oocyte age (Pearson correlation R = 0.43) versus correlation between the temporal derivative of the morphokinetic-based classification with and without oocyte age (Pearson correlation R = 0.27).</p></caption>
<graphic xlink:href="21264503v1_fig1.tif"/>
</fig>
<p>Here, we challenge this axiom. There is a general consensus that non-visual clinical properties contribute to the prediction of implantation outcomes [<xref ref-type="bibr" rid="c17">17</xref>, <xref ref-type="bibr" rid="c18">18</xref>, <xref ref-type="bibr" rid="c6">6</xref>, <xref ref-type="bibr" rid="c14">14</xref>], but that such information is not relevant for ranking embryos in the context of a single IVF cycle cohort that share the same non-visual clinical properties. This implies that the optimization task solved through machine learning in practice is different from the actual decision made in the clinic. Moreover, while successful implantation inherently implies that an embryo is of high implantation quality, a failed implantation can be caused by a defective embryo or be related to poor maternal clinical factors (such as oocyte age, uterus cavity and receptivity of the endometrium). This creates uncertainty in the ground truth labels of failed implanted embryos that may hamper the ability of machine learning models to generalize well during training. It is not clear whether using machine learning models trained with clinical information can hamper the selection of the most promising embryos for implantation, and what is the magnitude of the errors caused by the ambiguous labels of failed implantations.</p>
<p>We hypothesized that predicting implantation is not the optimal machine learning strategy for solving the embryo-ranking problem because features derived from clinical information shared among embryos from the same cohort are not relevant for the ranking task and because ambiguous labels confound the optimal ranking. We confirmed this hypothesis by comprehensively assessing the contribution of visual embryo properties and clinical factors, and by evaluating several criteria for training data selection with less ambiguous labels. Finally, we quantified the extent of these non-optimal strategies and propose conceptual and practical setups to overcome these limitations by training and applying separate classifiers for the different tasks of predicting embryo implantation potential and ranking.</p>
</sec>
<sec id="s2">
<title>Results</title>
<sec id="s2a">
<title>Decoupling embryo scoring and ranking using embryo morphology, morphokinetics and oocyte age</title>
<p>One important application of machine learning in IVF clinics is the prediction of successful implantation. This task involves training a machine learning classifier using a large number of embryos that either succeeded (KID-positive, KID-P) or failed (KID-negative, KID-N) to implant back to the uterus (Methods). During classifier training, each embryo is represented by its visual properties and non-visual clinical properties that are provided together with the implantation outcome as the target label (<xref rid="fig1" ref-type="fig">Fig. 1A</xref>). The trained classifier receives as input new embryos and predicts a score corresponding to their implantation potential; i.e., the probability for successful implantation. The visual embryo properties include the appearance of the embryo (termed morphology) and the time it takes to reach predefined stages in development (termed morphokinetics). Oocyte age, which in this study is equivalent to the maternal age (see Methods) is the most studied non-visual clinical property correlating with implantation. Other non-visual clinical factors may include infertility causes, history of previous IVF treatments, uterus cavity, receptivity of the endometrium, or any other property that is shared across all the embryos from the same cohort and thus cannot be directly extracted from the specific embryo&#x2019;s image. The embryo-specific visual properties reflect the intrinsic embryo&#x2019;s potential for implantation, whereas the cohort-specific non-visual clinical properties correspond to the embryo-extrinsic parameters. Successful implantation is heavily dependent on both the embryo-specific visual appearance and on the cohort-specific non-visual clinical factors.</p>
<p>We sought to systematically assess the contribution of non-visual clinical properties to embryo implantation by comparing machine learning models that rely on visual embryo features with or without non-visual clinical properties. Our data were composed of time-lapse videos collected from 4 clinics: 7904 IVF cycles that included 1314 KID-P and 6485 KID-N for Train, and 380 KID-P and 637 KID-N for Test (Methods, Table S1). The non-visual clinical property chosen was the oocyte age, shared among all embryos from the same IVF cycle cohort, and is probably the most common embryo-extrinsic property used for the embryo implantation prediction task [<xref ref-type="bibr" rid="c17">17</xref>]. First, we validated that the KID-P embryos were associated with younger oocytes (<xref rid="fig1" ref-type="fig">Fig. 1B</xref>). Next, we preprocessed the images (<xref rid="figS1" ref-type="fig">Fig. S1</xref>) using the morphology-based deep learning classifier described in a companion paper and in the Methods (<xref rid="figS2" ref-type="fig">Fig. S2A</xref>). This classifier provides a continuous score reflecting the implantation score for each embryo over time with or without the oocyte age as additional input to the embryo image (Methods, <xref rid="figS2" ref-type="fig">Fig. S2C</xref>). As expected, the classifier that had access to oocyte age outperformed the classifier that relied on morphology alone over time (<xref rid="fig1" ref-type="fig">Fig. 1C</xref>). To further verify that the oocyte age contributes to visual properties we devised a new classifier that calculated a continuous implantation score from the embryo morphokinetic properties (<xref rid="figS2" ref-type="fig">Fig. S2B</xref>, Methods). The timing of a set of fifteen hallmark morphokinetic events were identified automatically by combining machine-learning and dynamic programming (<xref rid="figS3" ref-type="fig">Figs. S3</xref>-<xref rid="figS4" ref-type="fig">4</xref>). These morphokinetic features were used to train a deep learning classifier to predict the implantation potential of an embryo based on its developmental history (see Methods for full details). Including the oocyte age as an additional feature improved the morphokinetic performance over time (<xref rid="fig1" ref-type="fig">Fig. 1D</xref>). Although the morphology-based classifier was more accurate than the morphokinetic-based classifier, the inclusion of oocyte age flipped the classification performance in favor of the morphokinetic model (<xref rid="fig1" ref-type="fig">Fig. 1E</xref>). This result suggests that the residual contribution of oocyte age to morphokinetic features was greater than the contribution of oocyte age to morphological features in the context of the implantation classification task. Correlating the temporal derivative of the corresponding classifier pairs showed that the temporal trend of the classification performance was more similar between the classifier pair that was trained with morphological features (with and without the oocyte age) than the classifier trained with the morphokinetic features, thus providing further evidence that the common classification-related information between morphology features and oocyte age was higher than between morphokinetic features and oocyte age (<xref rid="fig1" ref-type="fig">Fig. 1F</xref>). Since oocyte age is common to all cohort embryos and thus irrelevant for the ranking task, the prediction of the higher performing classifier for the implantation potential is not necessarily aligned with the clinician&#x2019;s task of ranking &#x201C;sibling&#x201D; embryos originating from the same IVF cycle. Hence, although the classifier trained with both morphokinetic features and oocyte age outperformed the classifier trained with both morphological features and oocyte age (especially in early embryo development), embryo morphological features seem more appropriate for the task of ranking high quality embryos. Thus, beyond providing a quantitative assessment of the contribution of oocyte age to implantation prediction, these results raise the possibility that clinical properties that are common across embryos from the same cohort contribute to the task of embryo scoring toward implantation but are not the optimal properties for the task of embryo ranking.</p>
</sec>
<sec id="s2b">
<title>Optimizing features for prediction of embryo implantation is not an optimal strategy for the task of embryo ranking</title>
<p>Embryos in an IVF cycle are partitioned into three groups by the clinician based on their visual properties. These are composed of 1) transferred embryos - the most promising embryos for implantation (Video S1), 2) frozen embryos - other visually high-quality embryos that are kept for transfers in future IVF cycles and 3) discarded embryos - those selected to be excluded based on their poor visual appearance (Video S2-S4). Discarded embryos can be further partitioned into two subgroups: those that reached blastulation (termed <italic>blastocyst-discarded</italic>, Video S2) and those that did not reach blastulation (termed <italic>underdeveloped-discarded</italic>, Videos S3-4). These partitions define the expected ordered ranking of embryos based on their visual appearance (<xref rid="fig2" ref-type="fig">Fig. 2A</xref>).</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2:</label>
<caption><p>Using oocyte age as feature for improving implantation prediction reduced the accuracy of ranking embryos from the same cohort. (<bold>A</bold>) Embryo visual evaluation: KID-P &#x003E; KID-N &#x003E; Blastocyst-discarded &#x003E; underdeveloped-discarded. KID-N and frozen embryos are not considered in embryo ranking evaluations because there is no clear distinction based on their visual properties. (<bold>B</bold>) Time To Live Birth (TTLB) for sub-cohorts of sibling embryos, as a function of the number of embryos considered for each cohort. Each sibling sub-cohort consisted of one implanted embryo and multiple discarded embryos sampled from the full cohort. In the example here the number of embryos was 5 and the TTLB was 2 because the KID-P embryo was ranked second. (<bold>C-D</bold>) Morphology-based models (marked with an embryo image) with or without oocyte age. (<bold>C</bold>) Ranking KID-P and all discarded embryos. Number of cycles with n = 2-8 embryos: 201, 180, 163, 141, 115, 93, 67. Corresponding Wilcoxon signed rank tests on the null hypothesis that the two ranking schemes were drawn from the same matched distribution: &#x003C;0.0001, &#x003C;0.0001, &#x003C;0.0001, &#x003C;0.0001, &#x003C;0.0001, &#x003C;0.0001, 0.005. (<bold>D</bold>) Ranking KID-P and blastocyst-discarded embryos. Number of cycles with n = 2-6 embryos: 145, 98, 54, 32, 13. Corresponding Wilcoxon signed-rank tests: &#x003C;0.0001, &#x003C;0.0001, &#x003C;0.0001, 0.001, 0.074. (<bold>E-F</bold>) Morphokinetic-based models (marked with &#x201C;T&#x201D;) with or without oocyte age. Number of cycles according to panels C-D respectively. (<bold>E</bold>) Ranking KID-P and all discarded embryos. Wilcoxon signed-rank tests: 0.001, 0.001, 0.001, 0.001, 0.004, 0.004, 0.039. (<bold>F</bold>) Ranking KID-P and blastocyst-discarded embryos. Wilcoxon signed-rank tests: 0.004, 0.004, 0.071, 0.157, 0.655.</p></caption>
<graphic xlink:href="21264503v1_fig2.tif"/>
</fig>
<p>A basic expectation of an embryo-ranking model is to prioritize KID-P over discarded embryos. To assess the performance of models trained to predict implantation results (KID-P versus KID-N) on the task of embryo ranking, we evaluated the average <italic>time to live birth</italic> (TTLB), the number of attempts for embryo transfer from an IVF cycle until a successful implantation was reached, where the transfer order was determined by the model&#x2019;s ranking based on its classification score [<xref ref-type="bibr" rid="c19">19</xref>]. For example, a TTLB value of 2 implies a cohort where the KID-P was ranked second; i.e., one discarded embryo had a higher classification score (<xref rid="fig2" ref-type="fig">Fig. 2B</xref>). The analysis included embryo cohorts that contained a successful implantation (KID-P) and multiple discarded embryos. While it is widely believed that transferring a discarded embryo will result in a failed implantation, the implantation outcome for frozen embryos is not clear-cut; hence, they were not considered in this analysis. To avoid the bias of cohorts with different numbers of embryos we compared the average TTLB of sub-cohorts consisting of the same number of embryos sampled from the full cohorts (Methods).</p>
<p>Oocyte age contributed to improved implantation prediction (<xref rid="fig1" ref-type="fig">Fig. 1C-D</xref>) but this information is not relevant for ranking embryos from the same cohort that share the same oocyte age. To test the hypothesis that optimizing features for the KID-P versus KID-N classification task can deteriorate ranking accuracy, we compared the performance of two classifiers that were trained with morphological features with or without the oocyte age. We first ranked sub-cohorts of one KID-P and multiple discarded embryos (Methods). The average TTLB was at most 1.25 and the inclusion of oocyte age led to less efficient (i.e., higher TTLB) ranking, that required on average 1.7 attempts to achieve successful implantation (<xref rid="fig2" ref-type="fig">Fig. 2C</xref>). The same less efficient ranking with oocyte age was observed for sub-cohorts with one KID-P and multiple blastocyst-discarded embryos (<xref rid="fig2" ref-type="fig">Fig. 2D</xref>). As expected, ranking with blastocyst-discarded embryos constituted a more challenging task because the visual defects are less obvious with respect to embryos that did not reach blastulation. Similar trends were obtained for morphokinetic features with or without oocyte age (<xref rid="fig2" ref-type="fig">Fig. 2E-F</xref>). Altogether, these results suggest that selecting features to optimize implantation prediction is not the optimal strategy for embryo ranking, specifically when these features are clinical properties that are common to all embryos in a cohort.</p>
</sec>
<sec id="s2c">
<title>KID-N embryos are not the ideal negative labels for the task of embryo ranking</title>
<p>After demonstrating that the features selected for their performance at implantation prediction were not optimal for embryo ranking we asked how different training data would affect the models&#x2019; performance when discriminating high quality from poor quality embryos. We defined a set of classification tasks that consisted of discriminating KID-P embryos from different subsets of discarded and/or unsuccessful implanted embryos. First, discriminating KID-P from all discarded embryos (<xref rid="fig3" ref-type="fig">Fig. 3A</xref>). This is an easy classification task because discarded embryos are characterized by evident visual defects. The second classification task involved discriminating KID-P from blastocyst-discarded embryos (<xref rid="fig3" ref-type="fig">Fig. 3B</xref>). The third involved discriminating KID-P from a subset that included both the KID-N as well as the discarded embryos (<xref rid="fig3" ref-type="fig">Fig. 3C</xref>). This latter setting is the one most similar to the true embryo ranking tasks in the clinic. For each of these embryo subsets we trained six morphology-based classifiers (Table S2) and their classification performance was compared on different classification tasks (Table S3, <xref rid="fig3" ref-type="fig">Fig. 3A-C</xref>).</p>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3:</label>
<caption><p>KID-N embryos are not the ideal negative label for solving the task of embryo ranking. (<bold>A-C</bold>) Prediction accuracy (AUC) over time since fertilization (higher scores reflect better performance). (<bold>D-E</bold>) Time To Live Birth (TTLB) for cohorts of sibling embryos, as a function of the number of embryos in each cohort (lower scores reflect better performance). Each siblings sub-cohort consisted of one implanted embryo and multiple discarded embryos from the same cohort. Number of cycles corresponding to those reported in <xref rid="fig2" ref-type="fig">Fig. 2</xref>. (<bold>A-E</bold>) All models were trained with morphological features. (<bold>A</bold>) KID-P versus discarded. (<bold>B</bold>) KID-P versus blastocyst-discarded. (<bold>C</bold>) KID-P versus KID-N and discarded. (<bold>D</bold>) Ranking KID-P and all discarded embryos. (<bold>E</bold>) Ranking KID-P and blastocyst-discarded embryos.</p></caption>
<graphic xlink:href="21264503v1_fig3.tif"/>
</fig>
<p>Classifiers trained to predict implantation (KID-P versus KID-N) were less accurate than the classifiers that were trained with discarded embryos on all tasks (<xref rid="fig3" ref-type="fig">Fig. 3A-C</xref>). Inclusion of the oocyte age deteriorated the performance to the levels of the classifiers that were trained to predict implantation (<xref rid="fig3" ref-type="fig">Fig. 3A-C</xref>). Direct evaluation of time to live birth established that models trained to predict embryo implantation were not necessarily optimal for the task of embryo ranking (<xref rid="fig3" ref-type="fig">Fig. 3D-E</xref>).</p>
<p>The KID-P versus KID-N labeled training data was severely limited in size because only a small subset of all embryos were selected for transfer and thus discarded embryos constitute the vast majority of embryos in IVF clinic in our study (Table S1) and in general [<xref ref-type="bibr" rid="c13">13</xref>, <xref ref-type="bibr" rid="c20">20</xref>]. To assess the contribution of the extended volume of training data we limited the amount of negative labeled training data across the different categories of discarded embryos to align with the number of KID-N embryos (Table S2) and demonstrated that classifiers trained with discarded embryos outperformed the classifier trained to predict implantation even without extra training data (<xref rid="fig3" ref-type="fig">Fig. 3A-E</xref>, compare orange and green versus red). Additional training data further enhanced the classifiers&#x2019; performance (<xref rid="figS5" ref-type="fig">Fig. S5</xref>). Similar results were obtained when using morphokinetic features (<xref rid="figS6" ref-type="fig">Figs. S6</xref>-<xref rid="figS7" ref-type="fig">7</xref>). Altogether, these results suggest that the elementary requirement of distinguishing poor from high quality embryos broke more frequently in the KID-P/KID-N trained classifiers, suggesting that KID-P/KID-N are not the optimal training data for the task of embryo ranking.</p>
</sec>
<sec id="s2d">
<title>Tradeoffs between training labels ambiguity and specificity in predicting implantation and ranking</title>
<p>In the clinic, embryo ranking within an IVF cycle is exclusively determined by assessing the embryos&#x2019; visual properties. In contrast, in the machine-learning solution, visual embryo properties only provide partial information in the context of implantation prediction. Failed implantations can be caused either by defected embryos or by embryo-extrinsic maternal clinical properties leading to non-receptive endometrium. This limitation translated to ambiguous (noisy) KID-N labels that can mislead the classifier during model training. The confidence in discarded embryos labels, in the context of successful or failed implantation is high because the criterion of being discarded is inherently visual and thus is not/less affected by external factors.</p>
<p>To assess the contribution of training data volume and confidence in labels we turned again to the task of predicting implantation. We found that including the discarded embryos as negative labels in addition to KID-N during training, enhanced the classifier&#x2019;s performance in the KID-P versus KID-N classification task (<xref rid="fig4" ref-type="fig">Fig. 4A</xref>). Similar results were achieved when using morphokinetic features (<xref rid="figS8" ref-type="fig">Fig. S8</xref>). These results imply that despite the fact that the KID-P/KID-N classifier was trained for the most visually challenging task, the availability of extensive data and reliable labels improved classification performance.</p>
<fig id="fig4" position="float" fig-type="figure">
<label>Figure 4:</label>
<caption><p>Analysis of implantation prediction and ranking performance as a function of negative label ambiguity and label specificity. All classifiers were trained using morphological features. (<bold>A</bold>) AUC of implantation prediction (KID-p versus KID-N) over time. Comparison of models trained to discriminate KID-P from different sets of negative labels: KID-N, discarded, blastocyst discarded, underdeveloped discarded, and KID-N&#x002B;discarded with or without oocyte age. (<bold>B</bold>) AUC of implantation prediction (KID-p versus KID-N) over time for models trained to discriminate between KID-P and discarded embryos with increasing fractions of label ambiguity - flipping &#x201C;KID-P&#x201D; to &#x201C;discarded&#x201D; labels (see Methods). (<bold>C-D</bold>) Time To Live Birth (TTLB) for models trained in panel B. (<bold>C</bold>) KID-P versus all discarded. (<bold>D</bold>) KID-P versus blastocyst-discarded.</p></caption>
<graphic xlink:href="21264503v1_fig4.tif"/>
</fig>
<p>The contribution of training label specificity to a particular classification task was demonstrated by the superiority of the model trained with the KID-N and the discarded embryos over the model trained with discarded embryos alone (<xref rid="fig4" ref-type="fig">Fig. 4A</xref> &#x2013; blue versus cyan correspondingly, both have comparable volume of negative training labels). This result is strengthen by the lack of a similar trend in other classification tasks where the addition of KID-N embryos to the training set did not contribute much to the performance (<xref rid="fig3" ref-type="fig">Fig. 3</xref>). These data demonstrate the tradeoff between label ambiguity and specificity and reveal that the combination of reduced ambiguity (but reduced specificity) in the discarded embryo labels along with increased specificity (but increased ambiguity) in the KID-N labels led to the most accurate implantation predictions.</p>
<p>To identify the breaking point between label ambiguity and specificity we simulated a gradual deterioration in the negative labels by flipping increasing fractions of positive labels to negative labels. This mimics the ambiguity of KID-N labels, where some viable embryos fail to implant for extrinsic maternal reasons and are thus mistakenly labeled as negatives. We evaluated the optimization problem of training models to discriminate KID-P from discarded embryos because of the higher confidence in the discarded embryos&#x2019; negative label. This analysis revealed that flipping 10&#x0025; of the discarded embryo labels was sufficient to drop the performance of the KID-P/discarded trained classifier below that of the KID-P/KID-N-trained classifier for the tasks of predicting implantation potential and ranking, thus underscoring the fact that small fractions of erroneous labels can cause major deteriorations in the model&#x2019;s performance (<xref rid="fig4" ref-type="fig">Fig. 4B-D</xref>). Altogether, these results highlight the interplay between label ambiguity, label specificity to a particular classification task and data volume during training in the context of IVF (<xref rid="fig5" ref-type="fig">Fig. 5</xref>).</p>
<fig id="fig5" position="float" fig-type="figure">
<label>Figure 5:</label>
<caption><p>Trade-offs between data volume, label ambiguity and specificity to a particular classification task of the negative labels. In our case the specificity was aligned with the embryo quality (KID-P &#x003E; blastocyst-discarded &#x003E; underdeveloped-discarded, <xref rid="fig2" ref-type="fig">Fig. 2A</xref>). Data volume of underdeveloped-discarded was the highest (Table S1). Label ambiguity was high for KID-N. The positive labels were always KID-P.</p></caption>
<graphic xlink:href="21264503v1_fig5.tif"/>
</fig>
</sec>
</sec>
<sec id="s3">
<title>Discussion</title>
<p>There is a consensus that clinical properties that are shared across all embryos within a cohort, such as oocyte age, play a key role in determining embryo implantation potential but have no effect on embryo ranking within a cohort. It is also well-accepted that some KID-N embryos are functional embryos that failed implantation due to embryo-extrinsic clinical factors. In this study we took the next conceptual step by demonstrating that training classifiers to predict implantation can lead to non-optimal transfer decisions as evident by the higher probabilities of preferring obviously visually defective embryos over successfully implanted embryos.</p>
<p>These results raise concerns as to the current common pipeline for machine-learning driven IVF that directly imply several practical recommendations. First, training models for embryo ranking should focus exclusively on embryo intrinsic features. These may include engineered features that measure specific embryo properties such as the appearance of pronuclei and fading timing (tPNa, tPNf), the number of pronuclei, pronuclei shape, symmetry [<xref ref-type="bibr" rid="c21">21</xref>, <xref ref-type="bibr" rid="c22">22</xref>, <xref ref-type="bibr" rid="c23">23</xref>] blastocyst expanded diameter and trophectoderm cell cycle length [<xref ref-type="bibr" rid="c24">24</xref>], temporal events [<xref ref-type="bibr" rid="c25">25</xref>, <xref ref-type="bibr" rid="c26">26</xref>] and/or training deep neural networks on the raw images [<xref ref-type="bibr" rid="c13">13</xref>] while avoiding embryo-extrinsic clinical factors that are shared by the other sibling embryos within the cohort. Second, the ambiguity in the KID-N labels makes implantation prediction a sub-optimal optimization problem both in model training as well as in model evaluation. Thus training with less ambiguous negative labels, such as discarded embryos, can enhance ranking accuracy (and perhaps even implantation prediction). Training with less ambiguous negative labels can either be implemented by including discarded embryos in the training binary classification tasks, as demonstrated here, and/or by defining optimization problems that are more specific for ranking [<xref ref-type="bibr" rid="c27">27</xref>]. The current data suggest that this approach can be beneficial using discarded embryos as negative labels even though discarded embryos are commonly thought as trivially discriminated from high quality embryos (low label specificity). Beyond better reflecting the clinician&#x2019;s decision that involves the evaluation of all the embryos in an IVF cycle, another benefit of considering discarded embryos lies in the magnitude of data available for training that exceeded five-folds in the current dataset, and bypasses the biased selection of transferred embryos.</p>
<p>Hence avoiding/reducing the confounding effects of embryo-extrinsic clinical factors and ambiguous labels, when solving a ranking problem, as well as using all the available embryos to increase training data, are key practical concepts to consider when devising machine learning solutions for IVF. We hope that the awareness raised by our findings will bring back the traditional two-step process of ranking embryos within a cohort and determining how many embryos to transfer based on embryo scoring that approximates implantation probabilities, where each of these tasks is optimized independently under the appropriate assumptions.</p>
</sec>
<sec id="s4">
<title>Methods</title>
<sec id="s4a">
<title>Experiments</title>
<sec id="s4a1">
<title>Data collection and ethics</title>
<p>The data were retrospectively collected from four clinics: the Ein-Kerem, and Mt. Scopus campuses of the Hadassah Hebrew University Medical Center, the Soroka University Medical Center, and the NYU Langone Prelude Fertility Center. After fertilization, the embryos were incubated in EmbryoscopeTM (Vitrolife, Copenhagen, Denmark), a time-lapse incubation and imaging system that acquires seven-layers of z-stack images 15&#x00B5;m apart at each time point every 15 to 20 minutes, where time 0 is defined as the fertilization time. We used the central focal plane, which was usually the most focused, for further analysis, on a total of roughly 360-480 images over a 5-day period for a single embryo. Time-lapse sequences of embryos were collected between July 2014 and December 2019 for oocytes aged 23.6-43.6 years (<xref rid="fig1" ref-type="fig">Fig. 1B</xref>). This study did not include donor oocyte IVF sessions and transfer of previously frozen embryos and thus the oocyte age is identical to the patient/maternal age and is shared among all embryos in a cohort. Embryos that were discarded before 114 hours were excluded from further analysis. Human embryo image/video data collected from patients were used in this study with institutional review board approval from the Investigation Review Board of Hadassah Hebrew University Medical Center (IRB# HMO-006-20). Overall, our dataset contained 47162 recorded videos of embryos collected from 7904 patients with informed consent for research and publication, under an institutional review board approval for secondary research use. Table S1 details the data splits between train and test.</p>
</sec>
<sec id="s4a2">
<title>Annotation of embryo clinical quality</title>
<p>Once the embryos reached the desired developmental stage, single or more embryos from a cohort were transferred. For those embryos that were transferred, implantation tagging was defined by one of the three possible Known Implantation Data (KID) tags: (i) KID-positive (KID-P): when all transferred embryos were successfully implanted (Video S1); (ii) KID-negative (KID-N): when none of the transferred embryos were successfully implanted; (iii) KID-unknown (KID-UK): when the outcome of each transferred embryo was uncertain. KID-UK embryos were excluded from further analysis due to their ambiguous outcomes. Non-transferred embryos were partitioned into two groups: (1) Discarded &#x2013; embryos that were excluded by the clinician because of defective morphology: poor morphology [<xref ref-type="bibr" rid="c8">8</xref>] or morophkinetics (i.e., slow or halted development). The discarded embryos were further partitioned into two subgroups: &#x201C;blastocyst-discarded&#x201D; (Video S2), embryos that reached blastulation, and &#x201C;underdeveloped-discarded&#x201D; (Videos S3-4), that did not reach blastulation. Based on these selection criteria we assume that discarded embryos fail to implant, and thus used these discarded embryos as a non-ambiguous label to assess the model&#x2019;s performance when ranking KID-P over discarded embryos. (2) Frozen &#x2013; visually proper embryos that were not selected for transfer because other sibling embryos from the same cohort were ranked higher. These embryos were frozen for a future transfer but were not considered for further analysis because their implantation potential was unknown. These partitions defined the embryo clinical ranking of implantation potential (<xref rid="fig2" ref-type="fig">Fig. 2A</xref>).</p>
</sec>
</sec>
<sec id="s4b">
<title>Analysis</title>
<sec id="s4b1">
<title>Cropping and resizing embryo images</title>
<p>A simple, low-cost, Convolutional Neural Network (CNN) was trained to segment and localize the embryo. The time-lapse incubation images are of size 500&#x00D7;500 pixels at seven focal planes. The segmentation network accepts a downscaled version of size of 128&#x00D7;128 pixels to enhance efficiency and speed. To deal with varying image focus we randomly selected different focal planes for training. The network outputs a pixel-wise binary classification segmentation mask of size 128&#x00D7;128. A U-NET architecture [<xref ref-type="bibr" rid="c28">28</xref>] was used, with 4 convolutional layers at each of the downlink/uplinks. Each layer was followed by a maxpool/upsample layer, ReLU activation function and batch normalization, where the number of features started from 8 and was doubled after each pooling. A diagram of the architecture and examples of the segmentation mask are shown in <xref rid="figS1" ref-type="fig">Fig. S1</xref>. Finally, the bounded embryo was cropped from the full sized (500&#x00D7;500 pixels) image and resized to 256&#x00D7;256 pixels image, denoted <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline1a.gif"/></alternatives></inline-formula>.</p>
</sec>
<sec id="s4b2">
<title>Training classifier to discriminate KID-P embryos from different subsets of lower quality embryos</title>
<p>The data included the KID-P, KID-N, and discarded embryos that were split into Train/Validation/Test datasets (Tables S1). Each cohort of sibling embryos was allocated to one of the Train/Validation/Test datasets. Transferred embryos in the training set had incubation periods ranging from 2 to 6 days, whereas transferred embryos in the test set were composed solely of embryos that reached incubation durations of 114 to 120 hours to enable comparable results between different time points on the exact same set. This design makes the KID-N test set even more challenging compared to the training negative set since some of the embryos in the training set were transferred earlier on day 3 but would eventually have been labelled inviable, discarded and not transferred if they were allowed to incubate until day 5.</p>
<p>The learning task was to classify an input <italic>x</italic><sup><italic>t</italic></sup>, where <italic>x</italic> is a feature representation of an embryo and <italic>t</italic> is time, to its ground-truth implantation binary outcome (detailed below). Features representations of an embryo included morphology (raw image), morphokinetic (timing of a predetermined set of embryo developmental stages) and each of these with the oocyte age as an additional feature. Details on each of these feature sets can be found below. The loss function used to train all three models was the binary cross entropy loss, a special case of <xref ref-type="disp-formula" rid="eqn2">equation (2)</xref>, with K=2. The output of the classifier was a scalar <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline1.gif"/></alternatives></inline-formula> that represent the implantation probability <italic>p</italic><sub><italic>t</italic></sub>:
<disp-formula id="eqn9">
<alternatives><graphic xlink:href="21264503v1_eqn9.gif"/></alternatives>
</disp-formula>
thus, all the models were of the form <italic>F</italic>: <italic>x</italic><sup><italic>t</italic></sup> &#x2192; <italic>s</italic><sup><italic>t</italic></sup>, where the feature representation <italic>x</italic><sup><italic>t</italic></sup> changed between models and <italic>s</italic><sup><italic>t</italic></sup> is the scalar prediction.</p>
<p>We trained twelve different classifiers. Six classifier where trained with morphology-based features and another six classifiers with morphokinetic-based features. Each classifier was trained to discriminate KID-P embryos from different sets of embryos (Table S2): (1) KID-P vs. KID-N; (2) KID-P vs. underdeveloped; (3) KID-P versus blastocyst discarded; (4) KID-P vs. all discarded; (5) KID-P vs. KID-N and all discarded; (6) KID-P vs. KID-P vs. KID-N and all discarded learned with oocyte age as an additional feature.</p>
<p>The morphology classifier, denoted Mh, received as input a single raw image. The morphokinetic classifier, denoted Mk, received a 15-dimensional vector holding the timing of specific morphokinetic events that were automatically extracted from the time-lapse stream. These two classifiers are described next.</p>
</sec>
<sec id="s4b3">
<title>Classification using morphological features</title>
<p>The morphology-based model <italic>M</italic><sub><italic>h</italic></sub> accepts single images as input and therefore exploits the embryo morphological information to predict implantation. The model was implemented using a CNN with a modified ResNet50 architecture [<xref ref-type="bibr" rid="c32">32</xref>]. To compensate for the drastic morphological changes throughout the embryo developmental process we used the ResNet50 base layers with multiple prediction heads <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline2.gif"/></alternatives></inline-formula>, each corresponding to a temporal window of two hour. Each head consisted of a 128 channel dense layer, followed by a scalar output layer <italic>s</italic><sup><italic>t</italic></sup>. <xref rid="figS2" ref-type="fig">Fig. S2A</xref> depicts the network&#x2019;s architecture. The morphology-based classier was described in a separate manuscript that is currently under review and is attached to the submission.</p>
</sec>
<sec id="s4b4">
<title>Automating the timing identification of morphokinetic events with machine-learning and dynamic programming</title>
<p>The problem of estimating the timing of early morphokinetic events was studied recently up to four [<xref ref-type="bibr" rid="c29">29</xref>, <xref ref-type="bibr" rid="c30">30</xref>], and up to eight [<xref ref-type="bibr" rid="c31">31</xref>] cells in the developing embryo, where all the later stages were considered as one state. We extended this scope to quantify both early and late morphokinetic events. Specifically, we automatically extracted timing of 15 morphokinetic events in the embryo development, i.e., the timing of specific morphological changes during embryo development identified from the time-lapse images (<xref rid="figS3" ref-type="fig">Fig. S3</xref>-<xref ref-type="fig" rid="figS4">4</xref>, Video S1). These morphokinetic features were then used to train classifiers (<xref rid="figS2" ref-type="fig">Fig. S2B</xref>).</p>
<p>More formally, the <italic>morphokinetic state S</italic> was defined by the following K = 15 morphokinetic events: Zygote, Pronuclei (PN) appearance and fading, 1Cell, 2Cell, &#x007C;3Cell, 4Cells, 5Cells, 6Cells, 7Cells, 8Cells, 9<sup>&#x002B;</sup>Cells, Morula, Start Blastulation, Blastocyst and Expanded Blastocyst.
<disp-formula id="eqn1">
<alternatives><graphic xlink:href="21264503v1_eqn1.gif"/></alternatives>
</disp-formula>
</p>
<p>We combined machine-learning and dynamic programming to automated the timing identification of each specific morphokinetic event. The learning task was defined as classifying an image acquired at time <italic>t, x</italic><sup><italic>t</italic></sup>, to its corresponding morphokinetic event <italic>y</italic><sup><italic>t</italic></sup> &#x2208; [1&#x2026; <italic>K</italic>], where the ground-truth annotations were determined manually by an expert for model training and evaluation. The training data were a set of the form <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline3.gif"/></alternatives></inline-formula>, where N was the number of embryos, and &#x0394;<italic>t</italic><sub><italic>i</italic></sub> was the time interval of the <italic>i-th</italic> embryo time-lapse incubation stream.</p>
<p>The morphokinetic model <italic>M</italic><sub><italic>k</italic></sub> is a multi-class classifier, trained using a CNN with a ResNet50 architecture [<xref ref-type="bibr" rid="c32">32</xref>] that accepts a single image <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline4.gif"/></alternatives></inline-formula> and predicts its morphokinetic event. <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline5.gif"/></alternatives></inline-formula> represents a cropped and resized image of the centered and resized embryo inside its well. The loss function was Categorical Cross Entropy loss [<xref ref-type="bibr" rid="c33">33</xref>] defined as
<disp-formula id="eqn2">
<alternatives><graphic xlink:href="21264503v1_eqn2.gif"/></alternatives>
</disp-formula>
<disp-formula id="eqn3">
<alternatives><graphic xlink:href="21264503v1_eqn3.gif"/></alternatives>
</disp-formula>
where <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline6.gif"/></alternatives></inline-formula> denotes the <italic>k-th</italic> output of <italic>M</italic><sub><italic>k</italic></sub> at time <italic>t</italic>. <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline7.gif"/></alternatives></inline-formula> is derived from <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline8.gif"/></alternatives></inline-formula> and represents the likelihood <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline9.gif"/></alternatives></inline-formula> of each image <italic>x</italic><sup><italic>t</italic></sup> to be in <italic>k</italic> &#x2212; <italic>th</italic> state. <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline10.gif"/></alternatives></inline-formula> is the one-hot encoded ground-truth. Namely,
<disp-formula id="eqn4">
<alternatives><graphic xlink:href="21264503v1_eqn4.gif"/></alternatives>
</disp-formula>
</p>
<p>We denote by T, the set of K-1 morphokinetic events, defined by the starting time of all states in <xref ref-type="disp-formula" rid="eqn1">equation (1)</xref>, except the first zygote, which is trivially defined by the time of the first frame <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline11.gif"/></alternatives></inline-formula>. Namely,
<disp-formula id="eqn5">
<alternatives><graphic xlink:href="21264503v1_eqn5.gif"/></alternatives>
</disp-formula>
where <italic>t</italic><sub><italic>X</italic></sub> denotes the starting time of the X-th ev. ent</p>
<p>The K size vector <italic>p</italic><sup><italic>t</italic></sup> can be thought as a &#x201C;soft annotation&#x201D; per each frame. To estimate the sequence of morphokinetic events given the per-frame soft annotations, we used dynamic programming, where the updating step at time <italic>t</italic> &#x002B; 1 is given by
<disp-formula id="eqn6">
<alternatives><graphic xlink:href="21264503v1_eqn6.gif"/></alternatives>
</disp-formula>
where <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline12.gif"/></alternatives></inline-formula> is a vector of size <italic>t</italic>, with the morphokinetic path at each time point <italic>t</italic> &#x2208; [1, <italic>t</italic>], that ends at the <italic>k-th</italic> state at time <italic>t</italic>, and <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline13.gif"/></alternatives></inline-formula> denotes a scalar score associated with the path <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline14.gif"/></alternatives></inline-formula>. Where <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline15.gif"/></alternatives></inline-formula> denotes the optimal path of state <italic>k</italic> at time <italic>t</italic>, in the sense that <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline16.gif"/></alternatives></inline-formula> has the highest score <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline17.gif"/></alternatives></inline-formula> out of all possible paths that end at the <italic>k-th</italic> state at time <italic>t</italic>.</p>
<p>Further, the updated score <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline18.gif"/></alternatives></inline-formula> is given by
<disp-formula id="eqn7">
<alternatives><graphic xlink:href="21264503v1_eqn7.gif"/></alternatives>
</disp-formula>
</p>
<p>Simply stated, at each time <italic>t</italic> &#x002B; 1, and for each state k, the optimal paths at time t of the states {<italic>k</italic> &#x2212; 1, <italic>k</italic>} are compared. The best path of the <italic>k-th</italic> state at time <italic>t</italic> &#x002B; 1 is the path with the highest score at time t, concatenated with the state <italic>k</italic> at time <italic>t</italic> &#x002B; 1. The new path score is the sum of the score of the best path from the {<italic>k</italic> &#x2212; 1, <italic>k</italic>} states and the score of the soft annotations score of the <italic>k-th</italic> state at time <italic>t</italic> &#x002B; 1. Finally, the estimated ME vector <bold><italic>m</italic></bold> <italic>=</italic> [<italic>m</italic><sub>1</sub>, <italic>m</italic><sub>2</sub>, &#x2026;. <italic>m</italic><sub><italic>k</italic>&#x2212;1</sub>]<sup><italic>T</italic></sup> is obtained by travelling over the transitions between states in <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline19.gif"/></alternatives></inline-formula>. Namely:
<disp-formula id="eqn8">
<alternatives><graphic xlink:href="21264503v1_eqn8.gif"/></alternatives>
</disp-formula>
</p>
<p><xref rid="figS3" ref-type="fig">Fig. S3</xref> demonstrates the soft annotations and dynamic programming outcomes for embryos with different developmental paths.</p>
<p>The accuracy of the annotation classification was measured by two measurements: (1) the average per frame accuracy, calculated as the average the 0-1 loss over frames, and (2) the confusion matrix of the morphokinetic events. <xref rid="figS4" ref-type="fig">Fig. S4</xref> presents the confusion matrices of morphokinetic events for the morphokinetic classifier before and after applying the dynamic programming stage, where rows denote the ground truth annotations, and columns the multi-class prediction. The confusion rates were prominent only between adjacent events. The first and final events presented relatively low confusion rates, whereas the intermediate morphokinetic events were subject to greater confusion rates with adjacent events. For example, distinguishing between 5C and 6C is more difficult than between 1C and 3C or between the morula and start of blastulation. These results align with annotation errors by expert embryologists. One exception is a blastocyst embryo, which the model confused with expanded blastocyst. However, this can be explained by the relatively vague definition of expansion, which in turn led to an inter (and even intra) variability in annotating the exact timing of when expansion began. The confusion matrix for the dynamic programming decision executed over the multi-class prediction exhibited a higher true positive rate for all events and improved average accuracy to 85.5&#x0025; compared to 83.6&#x0025; for the multi-class prediction. This is attributed to the consideration of the full developmental trajectory as a global optimization problem.</p>
</sec>
<sec id="s4b5">
<title>Classification using morphokinetic features</title>
<p>The morphokinetic-based model <italic>M</italic><sub><italic>k</italic></sub> accepts as input the estimated ME vector <bold><italic>m</italic></bold>, as calculated at time <italic>t</italic>. To allow the network to recognize embryos that stopped developing the time <italic>t</italic> was embedded to input vector. Formally, the input for model <bold><italic>M</italic></bold><sub><bold><italic>k</italic></bold></sub> was the K-dimensional vector <bold><italic>m</italic></bold><sup><italic>t</italic></sup>, defined as
<disp-formula id="eqn10">
<alternatives><graphic xlink:href="21264503v1_eqn10.gif"/></alternatives>
</disp-formula>
</p>
<p>The classifier was implemented with a neural network that consisted of 6 consecutive dense layers. The first 5 layers with 256 channels, and the last hidden layer consisted of 128 channels. Each layer was followed by ReLU activation and batch normalization. The final output layer was the scalar prediction. <xref rid="figS2" ref-type="fig">Fig. S2B</xref> depicts the network&#x2019;s architecture.</p>
</sec>
<sec id="s4b6">
<title>Classification using oocyte age</title>
<p>The oocyte age was determined by the age of the patient when the oocytes were retrieved from the ovary. Our dataset did not involve donors and did not include frozen embryos that were thawed and transferred. Thus, in this study, the oocyte age is equivalent to the patient/maternal age and is common to all embryos in a cohort. Oocyte age was previously reported to be highly correlated with implantation rates [<xref ref-type="bibr" rid="c18">18</xref>]. We included as an additional input to the morphology- and morphokinetic-based models, resulting in two new models denoted by <bold><italic>M</italic></bold><sub><bold><italic>ho</italic></bold></sub>, <bold><italic>M</italic></bold><sub><bold><italic>ko</italic></bold></sub> respectively. The architecture of these models was identical to their original models with the addition of an embedded layer that accepted oocyte age, digitized by one-hot encoding to one of five possible age groups, and outputted 128 features that corresponded to the hot age group. This output was added to the last hidden layer of the original model, followed by a dense layer with 128 channels and a scalar output layer. <xref rid="figS2" ref-type="fig">Fig S2C</xref> depicts the network&#x2019;s architecture.</p>
</sec>
<sec id="s4b7">
<title>Evaluating classifier performance in predicting embryo implantation and ranking</title>
<p>We evaluated the trained models&#x2019; performance with Area Under the Curve (AUC) measurement on four different binary classification tasks of discriminating KID-P embryos from different sets of embryos (Table S3): (1) KID-P vs. KID-N; (2) KID-P vs. all discarded embryos; (3) KID-P vs. blastocyst discarded; (4) KID-P vs. KID-N and all discarded embryos. This latter setting is most resembling the true embryo ranking in the clinic.</p>
<p>To directly assess the task of embryo ranking we evaluated the average number of attempts for embryo transfer from an IVF cycle until a successful implantation was reached, where the transfer order was determined by the model&#x2019;s ranking based on its classification score. This measurement is called <italic>time to live birth</italic> (TTLB) [<xref ref-type="bibr" rid="c19">19</xref>]. This analysis included embryo cohorts that contained a successful implantation (KID-P) and multiple discarded embryos, where transferring a discarded embryo is assumed to result in a failed implantation. Thus, a basic requirement from a ranking model is to prioritize KID-P over discarded embryos. To avoid the bias of cohorts with different numbers of embryos we compared the average TTLB of sub-cohorts consisting of the same number of embryos sampled from the full cohorts. For a given number of embryos (N = 2-8) we created sub-cohorts by selecting the KID-P embryo and N-1 discarded embryos. We considered two scenarios: (1) calculating TTLB for sets of one KID-P and discarded embryos (blastocyst and underdeveloped); (2) calculating TTLB for sets of one KID-P and multiple blastocyst-discarded embryos (more challenging).</p>
</sec>
<sec id="s4b8">
<title>Software and data availability</title>
<p>We are currently organizing our source code and will make it publically available as soon as possible (before journal publications). The clinical data are owned by Hadassah Hebrew University Medical Center, the Soroka University Medical Center, and the NYU Langone Prelude Fertility Center. Patients&#x2019; data were anonymously used under ethical agreements with each clinic separately, without explicit patient consent for their data to be made public. Thus, restrictions apply to the availability of these data. Requests for the anonymized data should be made to Dr. Assaf Ben-Meir (<email>assafb@hadassah.org.il</email>), Dr. Iris Har-Vardi (<email>harvardi@bgu.ac.il</email>), or Dr. James Grifo (<email>james.grifo@nyulangone.org</email>). Requests will be reviewed by a data access committee, taking into account the research proposal and intended use of the data. Requestors are required to sign a data-sharing agreement to ensure patients&#x2019; confidentiality is maintained prior to the release of any data. The methods presented are not specific to the datasets used in this study and users can train and test the deep learning model on any relevant imaging data.</p>
</sec>
</sec>
</sec>
<sec sec-type="supplementary-material">
<title>Supporting information</title>
<supplementary-material>
<label>Video S1</label>
<media xlink:href="supplements/264503_file02.mp4" />
</supplementary-material>
<supplementary-material>
<label>Video S2</label>
<media xlink:href="supplements/264503_file03.mp4" />
</supplementary-material>
<supplementary-material>
<label>Video S3</label>
<media xlink:href="supplements/264503_file04.mp4" />
</supplementary-material>
<supplementary-material>
<label>Video S4</label>
<media xlink:href="supplements/264503_file05.mp4" />
</supplementary-material>
<supplementary-material>
<label>Table S1</label>
<media xlink:href="supplements/264503_file06.xlsx" />
</supplementary-material>
<supplementary-material>
<label>Table S2</label>
<media xlink:href="supplements/264503_file07.xlsx" />
</supplementary-material>
<supplementary-material>
<label>Table S3</label>
<media xlink:href="supplements/264503_file08.xlsx" />
</supplementary-material>
</sec>
</body>
<back>
<sec sec-type="data-availability">
<title>Data Availability</title>
<p>We are currently organizing our source code and will make it publically available as soon as possible (before journal publications). The clinical data are owned by Hadassah Hebrew University Medical Center, the Soroka University Medical Center, and the NYU Langone Prelude Fertility Center. Patients' data were anonymously used under ethical agreements with each clinic separately, without explicit patient consent for their data to be made public. Thus, restrictions apply to the availability of these data. Requests for the anonymized data should be made to Dr. Assaf Ben-Meir (assafb@hadassah.org.il), Dr. Iris Har-Vardi (harvardi@bgu.ac.il), or Dr. James Grifo (james.grifo@nyulangone.org). Requests will be reviewed by a data access committee, taking into account the research proposal and intended use of the data. Requestors are required to sign a data-sharing agreement to ensure patients' confidentiality is maintained prior to the release of any data. The methods presented are not specific to the datasets used in this study and users can train and test the deep learning model on any relevant imaging data.</p>
</sec>
<ack>
<title>Funding and Acknowledgments</title>
<p>This research was supported by the Israel Council for Higher Education (CHE) via the Data Science Research Center, Ben-Gurion University of the Negev, Israel, by the Israel Science Foundation (grant No. 2516/21) and by the Welcome Leap Delta Tissue program (to AZ). We thank Maya Adani for designing and generating the figures. We thank Nadav Rappoport, Eran Eshed and Oded Rotem for critically reading the manuscript.</p>
</ack>
<sec id="s5">
<title>Author Contribution</title>
<p>IE conceived the study, developed analytic tools, and analyzed the data. IE and AZ interpreted the data and drafted the manuscript. AZ mentored IE. All authors wrote and edited the manuscript and approved its content.</p>
</sec>
<sec id="s6">
<title>Competing Financial Interests</title>
<p>IE, ABM and IHV are employees at Fairtility LTD. AZ is collaborating with AIVF LTD on projects not related to this study.</p>
</sec>
<ref-list>
<title>References</title>
<ref id="c1"><label>[1]</label><mixed-citation publication-type="other"><string-name><given-names>D. K.</given-names> <surname>Gardner</surname></string-name> and <string-name><given-names>B.</given-names> <surname>Balaban</surname></string-name>, &#x201C;<article-title>Assessment of human embryo development using morphological criteria in an era of time-lapse, algorithms and &#x2018;OMICS&#x2019;: is looking good still important?</article-title>,&#x201D; <source>MHR: Basic science of reproductive medicine</source>, <year>2016</year>.</mixed-citation></ref>
<ref id="c2"><label>[2]</label><mixed-citation publication-type="journal"><string-name><given-names>Y.</given-names> <surname>Tian</surname></string-name>, <string-name><given-names>W.</given-names> <surname>Wang</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Yin</surname></string-name>, <string-name><given-names>W.</given-names> <surname>Wang</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Duan</surname></string-name> and <string-name><given-names>S.</given-names> <surname>Zhao</surname></string-name>, &#x201C;<article-title>Predicting pregnancy rate following multiple embryo transfers using algorithms developed through static image analysis</article-title>,&#x201D; <source>Reproductive biomedicine online</source>, vol. <volume>34</volume>, p. <fpage>473</fpage>&#x2013;<lpage>479</lpage>, <year>2017</year>.</mixed-citation></ref>
<ref id="c3"><label>[3]</label><mixed-citation publication-type="journal"><string-name><given-names>J. M. R.</given-names> <surname>Gerris</surname></string-name>, &#x201C;<article-title>Single embryo transfer and IVF/ICSI outcome: a balanced appraisal</article-title>,&#x201D; <source>Human Reproduction Update</source>, vol. <volume>11</volume>, p. <fpage>105</fpage>&#x2013;<lpage>121</lpage>, <year>2005</year>.</mixed-citation></ref>
<ref id="c4"><label>[4]</label><mixed-citation publication-type="journal"><string-name><given-names>A.</given-names> <surname>Pinborg</surname></string-name>, &#x201C;<article-title>IVF/ICSI twin pregnancies: risks and prevention</article-title>,&#x201D; <source>Human reproduction update</source>, vol. <volume>11</volume>, p. <fpage>575</fpage>&#x2013;<lpage>593</lpage>, <year>2005</year>.</mixed-citation></ref>
<ref id="c5"><label>[5]</label><mixed-citation publication-type="journal"><string-name><given-names>L.</given-names> <surname>van Loendersloot</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Repping</surname></string-name>, <string-name><given-names>P. M. M.</given-names> <surname>Bossuyt</surname></string-name>, <string-name><given-names>F.</given-names> <surname>van der Veen</surname></string-name> and <string-name><given-names>M.</given-names> <surname>van Wely</surname></string-name>, &#x201C;<article-title>Prediction models in in vitro fertilization; where are we? A mini review</article-title>,&#x201D; <source>Journal of advanced research</source>, vol. <volume>5</volume>, p. <fpage>295</fpage>&#x2013;<lpage>301</lpage>, <year>2014</year>.</mixed-citation></ref>
<ref id="c6"><label>[6]</label><mixed-citation publication-type="journal"><string-name><given-names>B.</given-names> <surname>Raef</surname></string-name> and <string-name><given-names>R.</given-names> <surname>Ferdousi</surname></string-name>, &#x201C;<article-title>A review of machine learning approaches in assisted reproductive technologies</article-title>,&#x201D; <source>Acta Informatica Medica</source>, vol. <volume>27</volume>, p. <fpage>205</fpage>, <year>2019</year>.</mixed-citation></ref>
<ref id="c7"><label>[7]</label><mixed-citation publication-type="journal"><string-name><given-names>D. K.</given-names> <surname>Gardner</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Lane</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Stevens</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Schlenker</surname></string-name> and <string-name><given-names>W. B.</given-names> <surname>Schoolcraft</surname></string-name>, &#x201C;<article-title>Blastocyst score affects implantation and pregnancy outcome: towards a single blastocyst transfer</article-title>,&#x201D; <source>Fertility and sterility</source>, vol. <volume>73</volume>, p. <fpage>1155</fpage>&#x2013;<lpage>1158</lpage>, <year>2000</year>.</mixed-citation></ref>
<ref id="c8"><label>[8]</label><mixed-citation publication-type="journal"><string-name><given-names>J.</given-names> <surname>Zhang</surname></string-name>, <string-name><given-names>H.</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>X.</given-names> <surname>Mao</surname></string-name>, <string-name><given-names>Q.</given-names> <surname>Chen</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Fan</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Xiao</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Wang</surname></string-name> and <string-name><given-names>Y.</given-names> <surname>Kuang</surname></string-name>, &#x201C;<article-title>Effect of body mass index on pregnancy outcomes in a freeze-all policy: an analysis of 22,043 first autologous frozen-thawed embryo transfer cycles in China</article-title>,&#x201D; <source>BMC medicine</source>, vol. <volume>17</volume>, p. <fpage>1</fpage>&#x2013;<lpage>9</lpage>, <year>2019</year>.</mixed-citation></ref>
<ref id="c9"><label>[9]</label><mixed-citation publication-type="journal"><string-name><given-names>A.</given-names> <surname>Scientists</surname></string-name>, &#x201C;<article-title>The Istanbul consensus workshop on embryo assessment: proceedings of an expert meeting</article-title>,&#x201D; <source>Human reproduction</source>, vol. <volume>26</volume>, p. <fpage>1270</fpage>&#x2013;<lpage>1283</lpage>, <year>2011</year>.</mixed-citation></ref>
<ref id="c10"><label>[10]</label><mixed-citation publication-type="journal"><string-name><given-names>R.-S.</given-names> <surname>Guh</surname></string-name>, <string-name><given-names>T.-C. J.</given-names> <surname>Wu</surname></string-name> and <string-name><given-names>S.-P.</given-names> <surname>Weng</surname></string-name>, &#x201C;<article-title>Integrating genetic algorithm and decision tree learning for assistance in predicting in vitro fertilization outcomes</article-title>,&#x201D; <source>Expert Systems with Applications</source>, vol. <volume>38</volume>, p. <fpage>4437</fpage>&#x2013;<lpage>4449</lpage>, <year>2011</year>.</mixed-citation></ref>
<ref id="c11"><label>[11]</label><mixed-citation publication-type="journal"><string-name><given-names>G.</given-names> <surname>Corani</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Magli</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Giusti</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Gianaroli</surname></string-name> and <string-name><given-names>L. M.</given-names> <surname>Gambardella</surname></string-name>, &#x201C;<article-title>A Bayesian network model for predicting pregnancy after in vitro fertilization</article-title>,&#x201D; <source>Computers in biology and medicine</source>, vol. <volume>43</volume>, p. <fpage>1783</fpage>&#x2013;<lpage>1792</lpage>, <year>2013</year>.</mixed-citation></ref>
<ref id="c12"><label>[12]</label><mixed-citation publication-type="journal"><string-name><given-names>P.</given-names> <surname>Malinowski</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Milewski</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Ziniewicz</surname></string-name>, <string-name><given-names>A. J.</given-names> <surname>Milewska</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Czerniecki</surname></string-name> and <string-name><given-names>S.</given-names> <surname>Wo&#x0142;czy&#x0144;ski</surname></string-name>, &#x201C;<article-title>The use of data mining methods to Predict the Result of Infertility Treatment Using the IVF ET Method</article-title>,&#x201D; <source>Studies in Logic, Grammar and Rhetoric</source>, vol. <volume>39</volume>, p. <fpage>67</fpage>&#x2013;<lpage>74</lpage>, <year>2014</year>.</mixed-citation></ref>
<ref id="c13"><label>[13]</label><mixed-citation publication-type="journal"><string-name><given-names>D.</given-names> <surname>Tran</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Cooke</surname></string-name>, <string-name><given-names>P. J.</given-names> <surname>Illingworth</surname></string-name> and <string-name><given-names>D. K.</given-names> <surname>Gardner</surname></string-name>, &#x201C;<article-title>Deep learning as a predictive tool for fetal heart pregnancy following time-lapse incubation and blastocyst transfer</article-title>,&#x201D; <source>Human Reproduction</source>, vol. <volume>34</volume>, p. <fpage>1011</fpage>&#x2013;<lpage>1018</lpage>, <year>2019</year>.</mixed-citation></ref>
<ref id="c14"><label>[14]</label><mixed-citation publication-type="journal"><string-name><given-names>A.</given-names> <surname>Chavez-Badiola</surname></string-name>, <string-name><given-names>A. F.-S.</given-names> <surname>Farias</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Mendizabal-Ruiz</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Garcia-Sanchez</surname></string-name>, <string-name><given-names>A. J.</given-names> <surname>Drakeley</surname></string-name> and <string-name><given-names>J. P.</given-names> <surname>Garcia-Sandoval</surname></string-name>, &#x201C;<article-title>Predicting pregnancy test results after embryo transfer by image feature extraction and analysis using machine learning</article-title>,&#x201D; <source>Scientific reports</source>, vol. <volume>10</volume>, p. <fpage>1</fpage>&#x2013;<lpage>6</lpage>, <year>2020</year>.</mixed-citation></ref>
<ref id="c15"><label>[15]</label><mixed-citation publication-type="journal"><string-name><given-names>M. R.</given-names> <surname>Hassan</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Al-Insaif</surname></string-name>, <string-name><given-names>M. I.</given-names> <surname>Hossain</surname></string-name> and <string-name><given-names>J.</given-names> <surname>Kamruzzaman</surname></string-name>, &#x201C;<article-title>A machine learning approach for prediction of pregnancy outcome following IVF treatment</article-title>,&#x201D; <source>Neural computing and applications</source>, vol. <volume>32</volume>, p. <fpage>2283</fpage>&#x2013;<lpage>2297</lpage>, <year>2020</year>.</mixed-citation></ref>
<ref id="c16"><label>[16]</label><mixed-citation publication-type="journal"><string-name><given-names>M.</given-names> <surname>VerMilyea</surname></string-name>, <string-name><given-names>J. M. M.</given-names> <surname>Hall</surname></string-name>, <string-name><given-names>S. M.</given-names> <surname>Diakiw</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Johnston</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Nguyen</surname></string-name> and <string-name><given-names>D.</given-names> <surname>Perugini</surname></string-name>, &#x201C;<article-title>Development of an artificial intelligence-based assessment model for prediction of embryo viability using static images captured by optical light microscopy during IVF</article-title>,&#x201D; <source>Hum Reprod</source>, vol. <volume>35</volume>, p. <fpage>770</fpage>&#x00E2;\text{..}{8}{4}, <year>2020</year>.</mixed-citation></ref>
<ref id="c17"><label>[17]</label><mixed-citation publication-type="journal"><string-name><given-names>A. S. T.</given-names> <surname>Lim</surname></string-name> and <string-name><given-names>M. F. H.</given-names> <surname>Tsakok</surname></string-name>, &#x201C;<article-title>Age-related decline in fertility: a link to degenerative oocytes?</article-title>,&#x201D; <source>Fertility and Sterility</source>, vol. <volume>68</volume>, p. <fpage>265</fpage>&#x2013;<lpage>271</lpage>, <year>1997</year>.</mixed-citation></ref>
<ref id="c18"><label>[18]</label><mixed-citation publication-type="journal"><string-name><given-names>F.</given-names> <surname>Chen</surname></string-name>, <string-name><given-names>D.</given-names> <surname>De Neubourg</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Debrock</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Peeraer</surname></string-name>, <string-name><given-names>T.</given-names> <surname>D&#x2019;Hooghe</surname></string-name> and <string-name><given-names>C.</given-names> <surname>Spiessens</surname></string-name>, &#x201C;<article-title>Selecting the embryo with the highest implantation potential using a data mining based prediction model</article-title>,&#x201D; <source>Reproductive Biology and Endocrinology</source>, vol. <volume>14</volume>, p. <fpage>1</fpage>&#x2013;<lpage>12</lpage>, <year>2016</year>.</mixed-citation></ref>
<ref id="c19"><label>[19]</label><mixed-citation publication-type="journal"><string-name><given-names>S. K.</given-names> <surname>Sunkara</surname></string-name>, <string-name><given-names>W.</given-names> <surname>Zheng</surname></string-name>, <string-name><given-names>T.</given-names> <surname>D&#x2019;Hooghe</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Longobardi</surname></string-name> and <string-name><given-names>J.</given-names> <surname>Boivin</surname></string-name>, &#x201C;<article-title>Time as an outcome measure in fertility-related clinical studies: long-awaited</article-title>,&#x201D; <source>Human Reproduction</source>, vol. <volume>35</volume>, p. <fpage>1732</fpage>&#x2013;<lpage>1739</lpage>, <year>2020</year>.</mixed-citation></ref>
<ref id="c20"><label>[20]</label><mixed-citation publication-type="journal"><string-name><given-names>P.</given-names> <surname>Khosravi</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Kazemi</surname></string-name>, <string-name><given-names>Q.</given-names> <surname>Zhan</surname></string-name>, <string-name><given-names>J. E.</given-names> <surname>Malmsten</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Toschi</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Zisimopoulos</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Sigaras</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Lavery</surname></string-name>, <string-name><given-names>L. A. D.</given-names> <surname>Cooper</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Hickman</surname></string-name> and others, &#x201C;<article-title>Deep learning enables robust assessment and selection of human blastocysts after in vitro fertilization</article-title>,&#x201D; <source>NPJ digital medicine</source>, vol. <volume>2</volume>, p. <fpage>1</fpage>&#x2013;<lpage>9</lpage>, <year>2019</year>.</mixed-citation></ref>
<ref id="c21"><label>[21]</label><mixed-citation publication-type="journal"><string-name><given-names>J.</given-names> <surname>Aguilar</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Motato</surname></string-name>, <string-name><given-names>M. J.</given-names> <surname>Escrib&#x00E1;</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Ojeda</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Mu&#x00F1;oz</surname></string-name> and <string-name><given-names>M.</given-names> <surname>Meseguer</surname></string-name>, &#x201C;<article-title>The human first cell cycle: impact on implantation</article-title>,&#x201D; <source>Reproductive biomedicine online</source>, vol. <volume>28</volume>, p. <fpage>475</fpage>&#x2013;<lpage>484</lpage>, <year>2014</year>.</mixed-citation></ref>
<ref id="c22"><label>[22]</label><mixed-citation publication-type="journal"><string-name><given-names>L.</given-names> <surname>Scott</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Alvero</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Leondires</surname></string-name> and <string-name><given-names>B.</given-names> <surname>Miller</surname></string-name>, &#x201C;<article-title>The morphology of human pronuclear embryos is positively related to blastocyst development and implantation</article-title>,&#x201D; <source>Human reproduction</source>, vol. <volume>15</volume>, p. <fpage>2394</fpage>&#x2013;<lpage>2403</lpage>, <year>2000</year>.</mixed-citation></ref>
<ref id="c23"><label>[23]</label><mixed-citation publication-type="journal"><string-name><given-names>M.</given-names> <surname>Li</surname></string-name>, <string-name><given-names>W.</given-names> <surname>Zhao</surname></string-name>, <string-name><given-names>W.</given-names> <surname>Li</surname></string-name>, <string-name><given-names>X.</given-names> <surname>Zhao</surname></string-name> and <string-name><given-names>J.</given-names> <surname>Shi</surname></string-name>, &#x201C;<article-title>Prognostic value of three pro-nuclei (3PN) incidence in elective single blastocyst-stage embryo transfer</article-title>,&#x201D; <source>International journal of clinical and experimental medicine</source>, vol. <volume>8</volume>, p. <fpage>21699</fpage>, <year>2015</year>.</mixed-citation></ref>
<ref id="c24"><label>[24]</label><mixed-citation publication-type="journal"><string-name><given-names>L.</given-names> <surname>Bori</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Paya</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Alegre</surname></string-name>, <string-name><given-names>T. A.</given-names> <surname>Viloria</surname></string-name>, <string-name><given-names>J. A.</given-names> <surname>Remohi</surname></string-name>, <string-name><given-names>V.</given-names> <surname>Naranjo</surname></string-name> and <string-name><given-names>M.</given-names> <surname>Meseguer</surname></string-name>, &#x201C;<article-title>Novel and conventional embryo parameters as input data for artificial neural networks: an artificial intelligence model applied for prediction of the implantation potential</article-title>,&#x201D; <source>Fertility and Sterility</source>, vol. <volume>114</volume>, p. <fpage>1232</fpage>&#x2013;<lpage>1241</lpage>, <year>2020</year>.</mixed-citation></ref>
<ref id="c25"><label>[25]</label><mixed-citation publication-type="other"><string-name><given-names>B. M.</given-names> <surname>Petersen</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Boel</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Montag</surname></string-name> and <string-name><given-names>D. K.</given-names> <surname>Gardner</surname></string-name>, &#x201C;<article-title>Development of a generally applicable morphokinetic algorithm capable of predicting the implantation potential of embryos transferred on Day 3</article-title>,&#x201D; <source>Human reproduction</source>, <year>2016</year>.</mixed-citation></ref>
<ref id="c26"><label>[26]</label><mixed-citation publication-type="journal"><string-name><given-names>Y.</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>V.</given-names> <surname>Chapple</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Feenan</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Roberts</surname></string-name> and <string-name><given-names>P.</given-names> <surname>Matson</surname></string-name>, &#x201C;<article-title>Time-lapse deselection model for human day 3 in vitro fertilization embryos: the combination of qualitative and quantitative measures of embryo growth</article-title>,&#x201D; <source>Fertility and sterility</source>, vol. <volume>105</volume>, p. <fpage>656</fpage>&#x2013;<lpage>662</lpage>, <year>2016</year>.</mixed-citation></ref>
<ref id="c27"><label>[27]</label><mixed-citation publication-type="journal"><string-name><given-names>A.</given-names> <surname>Chavez-Badiola</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Flores-Saiffe-Farias</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Mendizabal-Ruiz</surname></string-name>, <string-name><given-names>A. J.</given-names> <surname>Drakeley</surname></string-name> and <string-name><given-names>J.</given-names> <surname>Cohen</surname></string-name>, &#x201C;<article-title>Embryo Ranking Intelligent Classification Algorithm (ERICA): artificial intelligence clinical assistant predicting embryo ploidy and implantation</article-title>,&#x201D; <source>Reproductive BioMedicine Online</source>, vol. <volume>41</volume>, p. <fpage>585</fpage>&#x2013;<lpage>593</lpage>, <year>2020</year>.</mixed-citation></ref>
<ref id="c28"><label>[28]</label><mixed-citation publication-type="other"><string-name><given-names>O.</given-names> <surname>Ronneberger</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Fischer</surname></string-name> and <string-name><given-names>T.</given-names> <surname>Brox</surname></string-name>, &#x201C;<article-title>U-net: Convolutional networks for biomedical image segmentation</article-title>,&#x201D; <source>in International Conference on Medical image computing and computer-assisted intervention</source>, <year>2015</year>.</mixed-citation></ref>
<ref id="c29"><label>[29]</label><mixed-citation publication-type="journal"><string-name><given-names>Z.</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>B.</given-names> <surname>Huang</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Cui</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Xu</surname></string-name>, <string-name><given-names>B.</given-names> <surname>Zhang</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Zhu</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Wang</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Jin</surname></string-name> and <string-name><given-names>D.</given-names> <surname>Wu</surname></string-name>, &#x201C;<article-title>Multitask deep learning with dynamic programming for embryo early development stage classification from time-lapse videos</article-title>,&#x201D; <source>IEEE Access</source>, vol. <volume>7</volume>, p. <fpage>122153</fpage>&#x2013;<lpage>122163</lpage>, <year>2019</year>.</mixed-citation></ref>
<ref id="c30"><label>[30]</label><mixed-citation publication-type="other"><string-name><given-names>N. H.</given-names> <surname>Ng</surname></string-name>, <string-name><given-names>J.</given-names> <surname>McAuley</surname></string-name>, <string-name><given-names>J. A.</given-names> <surname>Gingold</surname></string-name>, <string-name><given-names>N.</given-names> <surname>Desai</surname></string-name> and <string-name><given-names>Z. C.</given-names> <surname>Lipton</surname></string-name>, &#x201C;<source>Predicting embryo morphokinetics in videos with late fusion nets &#x0026; dynamic decoders</source>,&#x201D; <year>2018</year>.</mixed-citation></ref>
<ref id="c31"><label>[31]</label><mixed-citation publication-type="journal"><string-name><given-names>J.</given-names> <surname>Malmsten</surname></string-name>, <string-name><given-names>N.</given-names> <surname>Zaninovic</surname></string-name>, <string-name><given-names>Q.</given-names> <surname>Zhan</surname></string-name>, <string-name><given-names>Z.</given-names> <surname>Rosenwaks</surname></string-name> and <string-name><given-names>J.</given-names> <surname>Shan</surname></string-name>, &#x201C;<article-title>Automated cell division classification in early mouse and human embryos using convolutional neural networks</article-title>,&#x201D; <source>Neural Computing and Applications</source>, vol. <volume>33</volume>, p. <fpage>2217</fpage>&#x2013;<lpage>2228</lpage>, <year>2021</year>.</mixed-citation></ref>
<ref id="c32"><label>[32]</label><mixed-citation publication-type="other"><string-name><given-names>K.</given-names> <surname>He</surname></string-name>, <string-name><given-names>X.</given-names> <surname>Zhang</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Ren</surname></string-name> and <string-name><given-names>J.</given-names> <surname>Sun</surname></string-name>, &#x201C;<article-title>Deep Residual Learning for Image Recognition</article-title>,&#x201D; <source>arXiv preprint</source> arXiv:<pub-id pub-id-type="arxiv">1512.03385</pub-id>, <year>2015</year>.</mixed-citation></ref>
<ref id="c33"><label>[33]</label><mixed-citation publication-type="journal"><string-name><given-names>D. R.</given-names> <surname>Cox</surname></string-name>, &#x201C;<article-title>The regression analysis of binary sequences</article-title>,&#x201D; <source>Journal of the Royal Statistical Society: Series B (Methodological)</source>, vol. <volume>21</volume>, p. <fpage>238</fpage>&#x2013;<lpage>238</lpage>, <year>1959</year>.</mixed-citation></ref>
</ref-list>
<sec id="s7">
<title>Supplementary figures</title>
<fig id="figS1" position="float" fig-type="figure">
<label>Figure S1:</label>
<caption><p>Embryo segmentation network. (<bold>A</bold>) U-NET architecture for embryo localization and segmentation. (<bold>B</bold>) Output masks for different developmental stage embryos. From upper left to lower right: 2 cells, 9&#x002B; cells, blastocyst, expanded blastocyst.</p></caption>
<graphic xlink:href="21264503v1_figS1.tif"/>
</fig>
<fig id="figS2" position="float" fig-type="figure">
<label>Figure S2:</label>
<caption><p>Implantation model architectures. (<bold>A</bold>) Morphological model <italic>M</italic><sub><italic>h</italic></sub>, 128&#x00D7;128 input image, fed into Resnet50 CNN with multiple prediction heads. Each head corresponds to a temporal window of 2 hours. (<bold>B</bold>) Morphokinetic model <italic>M</italic><sub><italic>k</italic></sub>, accepts vector <bold><italic>m</italic></bold> with the estimated starts of 15 morphokinetic events, and the time from fertilization. A simple neural network with eight dense layers was used. (<bold>C</bold>) The oocyte age was added as input to each model, resulting in models <italic>M</italic><sub><italic>ho</italic></sub>, <italic>M</italic><sub><italic>ko</italic></sub> respectively. The oocyte age was passed through an embedded layer with 128 output channels. The embedding layer digitized the oocyte age to one of 5 age bins, and outputted the corresponding 128 channels. The embedded output was then added to the output of each of the basis models. Two dense layers conclude the architecture.</p></caption>
<graphic xlink:href="21264503v1_figS2.tif"/>
</fig>
<fig id="figS3" position="float" fig-type="figure">
<label>Figure S3:</label>
<caption><p>Predicted morphokinetic events vs. the ground truth (manual) annotations of different ending stage embryos: (<bold>A</bold>) 4Cells, (<bold>B</bold>) 8Cells, (<bold>C</bold>) Start Blastulation, (<bold>D</bold>) Expanded Blastocyst. The map represents the network multi-class prediction <italic>s</italic><sup><italic>t</italic></sup> of each frame vs. time. The horizontal lines are the dynamic programming output path <inline-formula><alternatives><inline-graphic xlink:href="21264503v1_inline20.gif"/></alternatives></inline-formula>, executed over the multi-class prediction map, and the vertical lines are the ground truth (manual) annotations. See Methods for full details.</p></caption>
<graphic xlink:href="21264503v1_figS3.tif"/>
</fig>
<fig id="figS4" position="float" fig-type="figure">
<label>Figure S4:</label>
<caption><p>Confusion matrix of morphokinetic state classification. Rows denote the ground truth annotations, and columns the multi-class prediction. Shown are multi-class model predictions before (<bold>A</bold>), and after (<bold>B</bold>) dynamic programming.</p></caption>
<graphic xlink:href="21264503v1_figS4.tif"/>
</fig>
<fig id="figS5" position="float" fig-type="figure">
<label>Figure S5:</label>
<caption><p>Additional training data enhances morphology-based models. Prediction accuracy: AUC vs. time since fertilization (hours) (<bold>A-C</bold>), average time to live birth (TTLB) (<bold>D-E</bold>) for morphology-based models, trained with different amounts of discarded embryos (negative labels): 10K and 30K, tested over different test sets. Training with more discarded embryos lead to better AUCs for all times and over all test sets, but did not change the TTLB. (<bold>A</bold>) KID-P vs. discarded. (<bold>B</bold>) KID-P vs. blastocyst discarded. (<bold>C</bold>) KID-P vs. KID-N and discarded. (<bold>D</bold>) Ranking KID-P and all discarded. (<bold>E</bold>) Ranking KID-P and blastocyst discarded.</p></caption>
<graphic xlink:href="21264503v1_figS5.tif"/>
</fig>
<fig id="figS6" position="float" fig-type="figure">
<label>Figure S6:</label>
<caption><p>KID-N embryos are not the ideal negative label for solving the task of embryo ranking. Prediction accuracy: AUC vs. time since fertilization (hours) (<bold>A-C</bold>), average time to live birth (TTLB) (<bold>D-E</bold>) for morphokinetic-based models, trained over different negatives: KID-N, discarded, blastocyst discarded, underdeveloped discarded, and KID-N&#x002B;discarded, tested over different test sets. (<bold>A</bold>) KID-P vs. all discarded. (<bold>B</bold>) KID-P. vs. blastocyst discarded. (<bold>C</bold>) KID-P vs. KID-N and all discarded. (<bold>D</bold>) Ranking KID-P and discarded. (<bold>E</bold>) Ranking KID-P and blastocyst discarded.</p></caption>
<graphic xlink:href="21264503v1_figS6.tif"/>
</fig>
<fig id="figS7" position="float" fig-type="figure">
<label>Figure S7:</label>
<caption><p>Additional training data enhances morphokinetic-based models. Prediction accuracy: AUC vs. time since fertilization (hours) (<bold>A-C</bold>), average time to live birth (TTLB) (<bold>D-E</bold>) for morphokinetic-based models, trained with different discarded amounts: 10K and 30K, tested over different test sets. Training with more negatives lead to better AUCs and yields to shorter TTLB over all test sets and times. (<bold>A</bold>) KID-P vs. discarded. (<bold>B</bold>) KID-P. vs. blastocyst discarded. (<bold>C</bold>) KID-P vs. KID-N and discarded. (<bold>D</bold>) Ranking KID-P and discarded. (<bold>E</bold>) Ranking KID-P and blastocyst discarded.</p></caption>
<graphic xlink:href="21264503v1_figS7.tif"/>
</fig>
<fig id="figS8" position="float" fig-type="figure">
<label>Figure S8:</label>
<caption><p>An analysis of optimizing implantation prediction accuracy by trading off label noise level and training data quality based on morphokinetic features. (<bold>A</bold>) Comparison of models trained on different negatives: KID-N, discarded, blastocyst discarded, underdeveloped discarded, and KID-N&#x002B;discarded (with and without oocyte age) over KID-P vs. KID-N test set. (<bold>B</bold>) AUCs for models trained with known noise levels (of positive labels) over KID-P vs. KID-N test set (<bold>C</bold>) TTLB for models trained with known noise levels (of positive labels) over KID-P vs. discarded test set (<bold>D</bold>) TTLB for models trained with known noise levels (of positives labels) over KID-P vs. blastocyst discarded test set.</p></caption>
<graphic xlink:href="21264503v1_figS8.tif"/>
</fig>
</sec>
<sec id="s8">
<title>Supplementary tables legends</title>
<p><bold>Table S1</bold>. Data table. Divided into Train/Validation and Test sets, where all embryos from a given cycle where either used for train, validation or test.</p>
<p><bold>Table S2</bold>. Train splits for the different trained models. The same amount of negative labels from each embryo discarded category was maintained across all sets of training in order to compare training with different negatives fairly. KID-N consists of the smallest amount of 6500 embryos, so 6500 embryos were randomly selected from all other negative sets</p>
<p>(Underdeveloped discarded &#x002B; Blastocyst discarded, Blastocyst discarded, KID-N &#x002B; Underdeveloped discarded &#x002B; Blastocyst discarded and Underdeveloped discarded), first considering all valid negatives, and then selecting 6500 embryos at random from the valid set.</p>
<p><bold>Table S3</bold>. Test splits for the different negatives sets.</p>
</sec>
<sec id="s9">
<title>Supplementary videos legends</title>
<p><bold>Video S1</bold>. Temporal evolution of a KID-P embryo. Bounding box marks the automatically detected embryo contour. Time (in hours) is displayed at the bottom-left. The predicted morphokinetic state and morphological-based implantation prediction score (KID-Score, from time = 30 hours) are displayed at the top-left. The KID-P score at the final frame is 1.</p>
<p><bold>Video S2</bold>. Temporal evolution of a blastocyst discarded embryo. Bounding box marks the automatically detected embryo contour. Time (in hours) is displayed at the bottom-left. The predicted morphokinetic state and morphological-based implantation prediction score (KID-Score, from time = 30 hours) are displayed at the top-left. The embryo was discarded after 126 hours, reaching the blastocyst (tB) stage, with a KID-P score of &#x2212;0.95.</p>
<p><bold>Video S3</bold>. Temporal evolution of an underdeveloped discarded embryo. Bounding box marks the automatically detected embryo contour. Time (in hours) is displayed at the bottom-left. The predicted morphokinetic state and morphological-based implantation prediction score (KID-Score, from time = 30 hours) are displayed at the top-left. The embryo was discarded after 127 hours, reaching the start of blastulation (tSB) stage with a KID-P score of &#x2212;1.31.</p>
<p><bold>Video S4</bold>. Temporal evolution of a very low-quality underdeveloped discarded embryo. Bounding box marks the automatically detected embryo contour. Time (in hours) is displayed at the bottom-left. The predicted morphokinetic state and morphological-based implantation prediction score (KID-Score, from time = 30 hours) are displayed at the top-left. The embryo stopped developing after reaching the Pronuclei fading stage (tPNf), with a KID-P score of &#x2212;9.</p>
</sec>
</back>
</article>