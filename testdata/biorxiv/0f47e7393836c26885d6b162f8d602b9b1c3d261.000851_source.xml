<article article-type="article" specific-use="production" xml:lang="en" xmlns:hw="org.highwire.hpp" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:ref="http://schema.highwire.org/Reference" xmlns:hwp="http://schema.highwire.org/Journal" xmlns:l="http://schema.highwire.org/Linking" xmlns:r="http://schema.highwire.org/Revision" xmlns:x="http://www.w3.org/1999/xhtml" xmlns:app="http://www.w3.org/2007/app" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:nlm="http://schema.highwire.org/NLM/Journal" xmlns:a="http://www.w3.org/2005/Atom" xmlns:c="http://schema.highwire.org/Compound" xmlns:hpp="http://schema.highwire.org/Publishing"><front><journal-meta><journal-id journal-id-type="hwp">biorxiv</journal-id><journal-id journal-id-type="publisher-id">BIORXIV</journal-id><journal-title>bioRxiv</journal-title><abbrev-journal-title abbrev-type="publisher">bioRxiv</abbrev-journal-title><publisher><publisher-name>Cold Spring Harbor Laboratory</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.1101/000851</article-id><article-id pub-id-type="other" hwp:sub-type="pisa">biorxiv;000851v1</article-id><article-id pub-id-type="other" hwp:sub-type="pisa-master">biorxiv;000851</article-id><article-id pub-id-type="other" hwp:sub-type="slug">000851</article-id><article-id pub-id-type="other" hwp:sub-type="tag">000851</article-id><article-version>1.1</article-version><article-categories><subj-group subj-group-type="author-type"><subject>Regular Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Contradictory Results</subject></subj-group><subj-group subj-group-type="hwp-journal-coll" hwp:journal-coll-id="Bioinformatics" hwp:journal="biorxiv"><subject>Bioinformatics</subject></subj-group></article-categories><title-group><article-title hwp:id="article-title-1">Comment on “TopHat2: accurate alignment of transcriptomes in the presence of insertions, deletions and gene fusions” by Kim et al.</article-title></title-group><contrib-group hwp:id="contrib-group-1"><contrib contrib-type="author" hwp:id="contrib-1"><name name-style="western" hwp:sortable="Dobin Alexander"><surname>Dobin</surname><given-names>Alexander</given-names></name></contrib><contrib contrib-type="author" hwp:id="contrib-2"><name name-style="western" hwp:sortable="Gingeras Thomas R."><surname>Gingeras</surname><given-names>Thomas R.</given-names></name></contrib><aff hwp:id="aff-1"><institution hwp:id="institution-1">Cold Spring Harbor Laboratory</institution>, Cold Spring Harbor, NY 11724</aff></contrib-group><pub-date pub-type="epub-original" hwp:start="2013"><year>2013</year></pub-date><pub-date pub-type="hwp-created" hwp:start="2013-11-22T13:54:15-08:00">
    <day>22</day><month>11</month><year>2013</year>
  </pub-date><pub-date pub-type="hwp-received" hwp:start="2013-11-22T13:54:15-08:00">
    <day>22</day><month>11</month><year>2013</year>
  </pub-date><pub-date pub-type="epub" hwp:start="2013-11-22T13:56:08-08:00">
    <day>22</day><month>11</month><year>2013</year>
  </pub-date><pub-date pub-type="epub-version" hwp:start="2013-11-22T13:56:08-08:00">
    <day>22</day><month>11</month><year>2013</year>
  </pub-date><elocation-id>000851</elocation-id><history hwp:id="history-1">
<date date-type="received" hwp:start="2013-11-22"><day>22</day><month>11</month><year>2013</year></date>
<date date-type="accepted" hwp:start="2013-11-22"><day>22</day><month>11</month><year>2013</year></date>
</history><permissions><copyright-statement hwp:id="copyright-statement-1">© 2013, Posted by Cold Spring Harbor Laboratory</copyright-statement><copyright-year>2013</copyright-year><license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by-nd/3.0/" hwp:id="license-1"><p hwp:id="p-1">This pre-print is available under a Creative Commons License (Attribution-NoDerivs 3.0 Unported), CC BY-ND 3.0, as described at <ext-link l:rel="related" l:ref-type="uri" l:ref="http://creativecommons.org/licenses/by-nd/3.0/" ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nd/3.0/" hwp:id="ext-link-1">http://creativecommons.org/licenses/by-nd/3.0/</ext-link></p></license></permissions><self-uri xlink:href="000851.pdf" content-type="pdf" xlink:role="full-text"/><self-uri l:ref="forthcoming:yes" c:role="http://schema.highwire.org/variant/full-text" xlink:href="file:/content/biorxiv/vol0/issue2019/pdf/000851v1.pdf" hwp:variant="yes" content-type="pdf" xlink:role="full-text"/><self-uri l:ref="forthcoming:yes" c:role="http://schema.highwire.org/variant/full-text" xlink:role="full-text" content-type="xhtml+xml" hwp:variant="yes"/><self-uri l:ref="forthcoming:yes" c:role="http://schema.highwire.org/variant/source" xlink:role="source" content-type="xml" xlink:show="none" hwp:variant="yes"/><self-uri l:ref="forthcoming:yes" c:role="http://schema.highwire.org/variant/original" xlink:role="original" content-type="xml" xlink:show="none" hwp:variant="yes" xlink:href="000851.xml"/><self-uri content-type="fulltext" xlink:href="file:/content/biorxiv/vol0/issue2019/fulltext/000851v1/000851v1.htslp"/><counts><page-count count="9"/></counts></article-meta></front><body><p hwp:id="p-2">In the recent paper [<xref ref-type="bibr" rid="c1" hwp:id="xref-ref-1-1" hwp:rel-id="ref-1">1</xref>] (thereafter referred to as “TopHat2paper”) the accuracy of TopHat2 was compared to other RNA-seq aligners. In this comment we re-examine most important analyses from the TopHat2paper and identify several deficiencies that significantly diminished performance of some of the aligners, including incorrect choice of mapping parameters, unfair comparison metrics, and unrealistic simulated data. Using STAR [<xref ref-type="bibr" rid="c2" hwp:id="xref-ref-2-1" hwp:rel-id="ref-2">2</xref>] as an exemplar, we demonstrate that correcting these deficiencies makes its accuracy equal or better than that of TopHat2. Furthermore, this exercise highlighted some serious issues with the TopHat2 algorithms, such as poor recall of alignments with a moderate (&gt;3) number of mismatches, low sensitivity and high false discovery rate for splice junction detection, loss of precision for the realignment algorithm, and large number of false chimeric alignments.</p><sec id="s1" hwp:id="sec-1" hwp:rev-id="xref-sec-1-1"><label>1.</label><title hwp:id="title-1">Mapping real RNA-seq data</title><p hwp:id="p-3">We utilized the experimental RNA-seq data ([<xref ref-type="bibr" rid="c3" hwp:id="xref-ref-3-1" hwp:rel-id="ref-3">3</xref>] GEO accession number: GSM818582) used in TopHat2paper, comprising ∼65M paired-end 2x101b reads.</p><sec id="s1a" hwp:id="sec-2"><label>1.1</label><title hwp:id="title-2">Mapping parameters</title><p hwp:id="p-4">For the TopHat2 runs, we used the same version (2.0.8) and parameters that were used in the TopHat2paper.</p><p hwp:id="p-5">For all analyses in the TopHat2paper STAR was run with the following parameters: <italic toggle="yes">–outFilterMismatchNmax 3 – outFilterMatchNmin 97 –outFilterScoreMin 90</italic>. The presumed intention was to limit the number of mismatches to 3 per <bold>each mate</bold> of the paired-end read, since TopHat2 and other aligners in the TopHat2paper were allowed 3 mismatches per mate. However, – <italic toggle="yes">outFilterMismatchNmax 3</italic> parameter limits the total number of mismatches for the <bold>whole paired-end read</bold> rather than each mate. Hence STAR was only allowed to output reads with 3 mismatches per pair. For a consistent comparison, we ran STAR with – o<italic toggle="yes">utFilterMismatchNmax 6,</italic> i.e. allowing 6 mismatches per pair. The other two parameters used in the TopHat2paper, – <italic toggle="yes">outFilterMatchNmin 97 –outFilterScoreMin 90,</italic> have no effect on the mapping because they are overridden by the default values of –<italic toggle="yes">outFilterScoreMinOverLread 0.66, –outFilterMatchNminOverLread 0.66.</italic></p></sec><sec id="s1b" hwp:id="sec-3"><label>1.2</label><title hwp:id="title-3">Edit distance</title><p hwp:id="p-6">Following the TopHat2paper, we are using “edit distance” as the main metric of alignment quality. Edit distance of an alignment is defined as the total number of mismatched, inserted or deleted bases with respect to the reference genome. For multi-mapping reads, the alignment with the smallest edit distance is chosen. For TopHat2 alignments, we obtained the edit distance from the “NM” SAM attribute. For STAR, we calculated the edit distance by comparing the read sequences to the reference genome, counting mismatches for both mapped (“M” operation in CIGAR) and soft-clipped bases (“S” operation in CIGAR), and counting indels from “D” and “I” operations in CIGAR.</p></sec><sec id="s1c" hwp:id="sec-4"><label>1.3</label><title hwp:id="title-4">Genome and annotations</title><p hwp:id="p-7">Following the Tophat2paper, we utilized ENSEMBL genome assembly and annotations. While reference genome in the TopHat2paper included only chromosomes 1-22,X,Y and mitochondrion genome (MT), we also incorporated non-chromosomal scaffolds (stored in the ENSEMBL file <ext-link l:rel="related" l:ref-type="uri" l:ref="http://Homo_sapiens.GRCh37.66.dna.nonchromosomal.fa" ext-link-type="uri" xlink:href="http://Homo_sapiens.GRCh37.66.dna.nonchromosomal.fa" hwp:id="ext-link-2">Homo_sapiens.GRCh37.66.dna.nonchromosomal.fa</ext-link>). We noted that the percentage of mapped reads for both STAR and TopHat2 are significantly higher in our runs than in the TopHat2paper, owing to a large number of reads that mapped to ribosomal RNA loci on the non-chromosomal scaffolds, which were not included in the TopHat2paper genomes.</p></sec><sec id="s1d" hwp:id="sec-5" hwp:rev-id="xref-sec-5-1"><label>1.4</label><title hwp:id="title-5">Paired-end alignments</title><p hwp:id="p-8">For paired-end reads, STAR standard mode of operation is to output only correctly (“concordantly”) paired alignments, while single-end and “chimeric” (discordant) alignments are filtered out. On the other hand, with the parameters used in TopHat2paper, TopHat2 was allowed to generate paired-end, single-end and chimeric alignments. In <xref rid="s2b" ref-type="sec" hwp:id="xref-sec-9-1" hwp:rel-id="sec-9">Section 2.2</xref> we will show that TopHat2 produces a large number (∼10% of all reads) of false chimeric alignments even for a simplistic simulated dataset. It is possible that in real RNA-seq data, a few discordant pairs represent real fusion transcripts; however, the majority of discordant pairs are likely to be mis-mapping artifacts.</p><p hwp:id="p-9">Therefore we believe the comparisons between aligners have to be performed only on concordantly mapped pairs. Several comparisons in the TopHat2paper (such as presented in <xref rid="fig2" ref-type="fig" hwp:id="xref-fig-2-1" hwp:rel-id="F2">Figures 2</xref>,3 / Tables S5,S6) do not take into account pair concordance and thus do not allow for a fair comparison.</p><fig id="fig1" position="float" orientation="portrait" fig-type="figure" hwp:id="F1" hwp:rev-id="xref-fig-1-1 xref-fig-1-2 xref-fig-1-3 xref-fig-1-4 xref-fig-1-5 xref-fig-1-6"><object-id pub-id-type="other" hwp:sub-type="pisa">biorxiv;000851v1/FIG1</object-id><object-id pub-id-type="other" hwp:sub-type="slug">F1</object-id><object-id pub-id-type="publisher-id">fig1</object-id><label>Figure 1</label><caption hwp:id="caption-1"><title hwp:id="title-6">Percentage of reads (Y-axis) with the minimum number of correctly mapped bases per pair (X-axis) for simulated datasets.</title><p hwp:id="p-10">For each value <italic toggle="yes">x</italic> on the X-axis, the percentage of reads (normalized to the total number (20M) of simulated reads) mapped with the number of correct bases ≥ <italic toggle="yes">x</italic> is plotted. (a) Simulated data from the TopHat2paper: no realignment (<xref rid="tbl3" ref-type="table" hwp:id="xref-table-wrap-3-1" hwp:rel-id="T3">Table 3</xref>, lines 1,2); (b) Simulated data from the TopHat2paper: STAR 2-step, TopHat2 realignment (<xref rid="tbl3" ref-type="table" hwp:id="xref-table-wrap-3-2" hwp:rel-id="T3">Table 3</xref>, lines 3,4); (c) Simulated data with realistic gene expression: no realignment (<xref rid="tbl4" ref-type="table" hwp:id="xref-table-wrap-4-1" hwp:rel-id="T4">Table 4</xref>, lines 1,2); (d) Simulated data with realistic gene expression, STAR 2-step, TopHat2 realignment (<xref rid="tbl4" ref-type="table" hwp:id="xref-table-wrap-4-2" hwp:rel-id="T4">Table 4</xref>, lines 3,4).</p></caption><graphic xlink:href="000851_fig1" position="float" orientation="portrait" hwp:id="graphic-1"/></fig><p hwp:id="p-11">In <xref rid="tbl1" ref-type="table" hwp:id="xref-table-wrap-1-1" hwp:rel-id="T1">Table 1</xref> we present the cumulative number of concordantly mapped pairs as a function of pair edit distance for the pairs (which is equal to the sum of edit distances of the mates). The same metric was used in TopHat2paper Figure S3 and Table S10. Columns 1 and 2 of <xref rid="tbl1" ref-type="table" hwp:id="xref-table-wrap-1-2" hwp:rel-id="T1">Table 1</xref> show the numbers of mapped reads for STAR and TopHat2 alignments without annotations, while columns 3 and 4 show the same numbers for annotations-aware alignments. In both cases STAR produces more alignments then TopHat2 for all edit distances, in stark contrast with the TopHat2paper results.</p><table-wrap id="tbl1" orientation="portrait" position="float" hwp:id="T1" hwp:rev-id="xref-table-wrap-1-1 xref-table-wrap-1-2 xref-table-wrap-1-3 xref-table-wrap-1-4 xref-table-wrap-1-5"><object-id pub-id-type="other" hwp:sub-type="pisa">biorxiv;000851v1/TBL1</object-id><object-id pub-id-type="other" hwp:sub-type="slug">T1</object-id><object-id pub-id-type="publisher-id">tbl1</object-id><label>Table 1</label><caption hwp:id="caption-2"><title hwp:id="title-7">Number of mapped pairs vs. pair edit distance.</title></caption><graphic xlink:href="000851_tbl1" position="float" orientation="portrait" hwp:id="graphic-2"/></table-wrap><p hwp:id="p-12">TopHat2 can be run in the “realignment” mode which substantially improves mapping sensitivity for annotations-lacking runs. As was discussed in the STAR paper [<xref ref-type="bibr" rid="c2" hwp:id="xref-ref-2-2" hwp:rel-id="ref-2">2</xref>], STAR can also be run in the 2-pass fashion, in which the junctions discovered in the 1<sup>st</sup> mapping pass are utilized to increase sensitivity of the alignments in the 2<sup>nd</sup> pass. While these advanced strategies improve performance of both aligners, the sensitivity of STAR 2-step mode is higher than that of TopHat2 realignment algorithm (columns 5 vs 6 of the <xref rid="tbl1" ref-type="table" hwp:id="xref-table-wrap-1-3" hwp:rel-id="T1">Table 1</xref>). We note that this 2-pass scheme can be adapted by most RNA-seq aligners and is very beneficial for the situations where annotations are not available.</p></sec><sec id="s1e" hwp:id="sec-6"><label>1.5</label><title hwp:id="title-8">Alignments with moderate (&gt;3) edit distances</title><p hwp:id="p-13">The maximum edit distance was limited to 3 for all the analyses in the TopHat2paper. Realistic sequencing data, even of the highest quality, may contain reads with edit distances larger than 3, owing to poor quality of the read tails, poly-A tails, highly variable genomic loci, and RNA-editing. In addition, short splice overhangs often cannot be confidently positioned and have to be clipped off. As the read length grows with the advancements in sequencing technologies, the aligners will be required to deal with ever-increasing number of mismatches and indels. We ran STAR and TopHat2 with parameters allowing larger edit distances, and calculated the number of concordantly paired alignments as a function of pair edit distance (<xref rid="tbl2" ref-type="table" hwp:id="xref-table-wrap-2-1" hwp:rel-id="T2">Table 2</xref>). Surprisingly, with the exception of the “realignment” mode, the numbers of TopHat2 alignments for edit distances from 0 to 3 dropped substantially (<xref rid="tbl2" ref-type="table" hwp:id="xref-table-wrap-2-2" hwp:rel-id="T2">Table 2</xref> columns 2,4) compared to the runs with more restrictive parameters (<xref rid="s1d" ref-type="sec" hwp:id="xref-sec-5-1" hwp:rel-id="sec-5">Section 1.4</xref>, <xref rid="tbl1" ref-type="table" hwp:id="xref-table-wrap-1-4" hwp:rel-id="T1">Table 1</xref> columns 2,4). Consequently, STAR’s mapping rate is substantially (&gt;10%) higher than TopHat2’s in “no annotation” (columns 1 vs 2 of <xref rid="tbl2" ref-type="table" hwp:id="xref-table-wrap-2-3" hwp:rel-id="T2">Table 2</xref>) and “annotation” (columns 3 vs 4 of <xref rid="tbl2" ref-type="table" hwp:id="xref-table-wrap-2-4" hwp:rel-id="T2">Table 2</xref>) cases, and slightly higher for the “realignment” mode.</p><table-wrap id="tbl2" orientation="portrait" position="float" hwp:id="T2" hwp:rev-id="xref-table-wrap-2-1 xref-table-wrap-2-2 xref-table-wrap-2-3 xref-table-wrap-2-4 xref-table-wrap-2-5"><object-id pub-id-type="other" hwp:sub-type="pisa">biorxiv;000851v1/TBL2</object-id><object-id pub-id-type="other" hwp:sub-type="slug">T2</object-id><object-id pub-id-type="publisher-id">tbl2</object-id><label>Table 2</label><caption hwp:id="caption-3"><title hwp:id="title-9">Number of mapped pairs vs. pair edit distance for mapping that allowed for larger edit distances.</title></caption><graphic xlink:href="000851_tbl2" position="float" orientation="portrait" hwp:id="graphic-3"/></table-wrap></sec></sec><sec id="s2" hwp:id="sec-7"><label>2.</label><title hwp:id="title-10">Mapping simulated RNA-seq reads</title><sec id="s2a" hwp:id="sec-8" hwp:rev-id="xref-sec-8-1"><label>2.1</label><title hwp:id="title-11">Simulated dataset from the TopHat2paper</title><p hwp:id="p-14">We mapped the simulated error-free paired-end 2x100b dataset utilized in the <xref rid="tbl2" ref-type="table" hwp:id="xref-table-wrap-2-5" hwp:rel-id="T2">Table 2</xref> of the TopHat2paper using the TopHat2 parameters from the TopHat2paper and default parameters for STAR.</p><p hwp:id="p-15">In case of such error-free reads the choice of default or more restrictive parameters (as were used in the TopHat2paper) does not significantly affect STAR alignments. For each read we calculated the number of bases that were correctly mapped by each aligner. For the multi-mapping reads the alignment with the maximum number of correctly mapped bases was chosen.</p><p hwp:id="p-16"><xref rid="fig1" ref-type="fig" hwp:id="xref-fig-1-1" hwp:rel-id="F1">Figure 1a</xref> shows the percentage of reads (Y-axis) with the minimum number of correctly mapped bases (X-axis). In agreement with observations in TopHat2paper, STAR finds completely (200b out of 200b) correct alignments for fewer reads than TopHat2 (85.5% vs 96.8%, lines 1 vs 2, column 1 of <xref rid="tbl3" ref-type="table" hwp:id="xref-table-wrap-3-3" hwp:rel-id="T3">Table 3</xref>). As was pointed out in TopHat2paper, this is caused by STAR’s inability to align very short overhangs (∼10b or less) of spliced reads (referred to as “short-anchored” reads in the TopHat2paper). However, for the majority of these reads STAR aligns correctly the remainder of the sequence, and for reads with ≥190 correctly mapped bases (95% of the paired-end read sequence) STAR’s sensitivity reaches that of TopHat2. For almost all the reads in this simulated dataset, STAR maps correctly at least 150 bases, slightly outperforming TopHat2 (99.6% vs. 97.6%, lines 1 vs 2 column 2 of <xref rid="tbl3" ref-type="table" hwp:id="xref-table-wrap-3-4" hwp:rel-id="T3">Table 3</xref>).</p><table-wrap id="tbl3" orientation="portrait" position="float" hwp:id="T3" hwp:rev-id="xref-table-wrap-3-1 xref-table-wrap-3-2 xref-table-wrap-3-3 xref-table-wrap-3-4 xref-table-wrap-3-5 xref-table-wrap-3-6 xref-table-wrap-3-7 xref-table-wrap-3-8 xref-table-wrap-3-9 xref-table-wrap-3-10 xref-table-wrap-3-11"><object-id pub-id-type="other" hwp:sub-type="pisa">biorxiv;000851v1/TBL3</object-id><object-id pub-id-type="other" hwp:sub-type="slug">T3</object-id><object-id pub-id-type="publisher-id">tbl3</object-id><label>Table 3.</label><caption hwp:id="caption-4"><title hwp:id="title-12">Mapping statistics for the simulated RNA-seq dataset from TopHat2paper.</title></caption><graphic xlink:href="000851_tbl3" position="float" orientation="portrait" hwp:id="graphic-4"/></table-wrap><p hwp:id="p-17">Another important accuracy metric is the sensitivity and false discovery rate (FDR) of the splice junctions’ detection, presented in columns 5-8 of <xref rid="tbl3" ref-type="table" hwp:id="xref-table-wrap-3-5" hwp:rel-id="T3">Table 3</xref>. Only uniquely mapped reads were considered, since including the multi-mapping reads improves sensitivity for both STAR and TopHat2 very slightly, while, at the same time, increases significantly the number of false positive junctions. Given that TopHat2 only detects junctions with GT/AG, GC/AG and AT/AC intron motifs, the junctions with all other intron motifs were excluded from this comparison. Even though STAR does not map very short spliced overhangs, it detects 4,976 more true junctions than TopHat2 (lines 1 vs 2 column 5 of <xref rid="tbl3" ref-type="table" hwp:id="xref-table-wrap-3-6" hwp:rel-id="T3">Table 3</xref>) for a moderate gain in sensitivity (95.3% vs 90%, lines 1 vs 2 column 6 of <xref rid="tbl3" ref-type="table" hwp:id="xref-table-wrap-3-7" hwp:rel-id="T3">Table 3</xref>). At the same time STAR demonstrates a much lower FDR than TopHat2 (0.4% vs 1.5% line 1 vs 2 column 8 of <xref rid="tbl3" ref-type="table" hwp:id="xref-table-wrap-3-8" hwp:rel-id="T3">Table 3</xref>).</p><p hwp:id="p-18">As we discussed above and in the STAR paper [<xref ref-type="bibr" rid="c2" hwp:id="xref-ref-2-3" hwp:rel-id="ref-2">2</xref>], in the absence of annotations, STAR will benefit from the 2-pass mode which improves the recovery of the short spliced overhangs by exploiting the junctions detected in the 1<sup>st</sup> pass. This approach is compared to a similar TopHat2 “realignment” strategy in lines 3 vs 4 of the <xref rid="tbl3" ref-type="table" hwp:id="xref-table-wrap-3-9" hwp:rel-id="T3">Table 3</xref> and <xref rid="fig1" ref-type="fig" hwp:id="xref-fig-1-2" hwp:rel-id="F1">Figure 1b</xref>. The recovery of the completely correct alignments (200b) in the STAR-2-pass mode improves drastically to 99.2%, outperforming TopHat2-realignment rate of 97.9% (lines 3 vs 4, column 1 of <xref rid="tbl3" ref-type="table" hwp:id="xref-table-wrap-3-10" hwp:rel-id="T3">Table 3</xref>). The junctions’ detection sensitivity of the TopHat2-realignment does not improve substantially; however, unexpectedly, the number of false positive junctions is severely increased (FDR=4%, column 8).</p></sec><sec id="s2b" hwp:id="sec-9" hwp:rev-id="xref-sec-9-1"><label>2.2</label><title hwp:id="title-13">Simulated dataset with a realistic gene expression profile</title><p hwp:id="p-19">Quoting from the TopHat2paper, “Both TopHat2 and MapSplice use a two-step algorithm, first detecting potential splice sites, and then using these sites to map reads. This two-step method may explain their superior performance at mapping reads with short anchors.” We note that such approaches (including STAR 2-pass) will work better if RNA transcripts are covered by a sufficient number of read, so that the “potential splice sites” can be confidently detected in the first step. However, real transcriptomes usually contain a large number of low expressed transcripts which do not satisfy this requirement.</p><p hwp:id="p-20">To check whether the simulated datasets resembles the real RNA-seq data, we calculated the transcript abundances using the true read count per transcript for the TopHat2paper simulated dataset, and using Cufflinks 2.1.1 on TopHat2 alignments (run with annotations, no realignment, column 4 of <xref rid="tbl1" ref-type="table" hwp:id="xref-table-wrap-1-5" hwp:rel-id="T1">Table 1</xref>) for the real RNA-seq data (same dataset as used in TopHat2 paper and the <xref rid="s1" ref-type="sec" hwp:id="xref-sec-1-1" hwp:rel-id="sec-1">Section 1</xref> of this Comment). <xref rid="fig1" ref-type="fig" hwp:id="xref-fig-1-3" hwp:rel-id="F1">Figure 2</xref> shows the simulated and real distributions of FPKM values, defined as the number of paired-end fragments per kilobase of transcript length per million of mapped fragments. Compared with the real RNA expression profile, the simulated dataset is strongly enriched for high-abundance and depleted for low-abundance transcripts. This biased distribution is likely to favor “two-step” approaches such as TopHat2-realignment or STAR-2-pass.</p><fig id="fig2" position="float" orientation="portrait" fig-type="figure" hwp:id="F2" hwp:rev-id="xref-fig-2-1"><object-id pub-id-type="other" hwp:sub-type="pisa">biorxiv;000851v1/FIG2</object-id><object-id pub-id-type="other" hwp:sub-type="slug">F2</object-id><object-id pub-id-type="publisher-id">fig2</object-id><label>Figure 2</label><caption hwp:id="caption-5"><title hwp:id="title-14">Transcript expression distribution for real and simulated RNA-seq data.</title></caption><graphic xlink:href="000851_fig2" position="float" orientation="portrait" hwp:id="graphic-5"/></fig><p hwp:id="p-21">To assess the effect of the simulated transcript expression distribution bias on the mapping quality, we generated another simulated dataset with transcript abundances matching the real FPKM distribution. The number of simulated reads per transcript was proportional to real FPKM values with a total of 20 Million 2x100b paired-end reads. The 5’ ends of the reads were assumed to be distributed uniformly along the transcript sequences, while the 3’ ends were constrained by the 3’ ends of the transcripts, and required to produce a Gaussian distribution of insert sizes. Following the TopHat2paper, for simplicity of the comparison with <xref rid="s2a" ref-type="sec" hwp:id="xref-sec-8-1" hwp:rel-id="sec-8">Section 2.1</xref>, we did not introduce any genomic variations or sequencing errors in this dataset. STAR and TopHat2 were run on this more realistic simulated dataset and the results are presented in <xref rid="fig1" ref-type="fig" hwp:id="xref-fig-1-4" hwp:rel-id="F1">Figure 1c,d</xref> and <xref rid="tbl4" ref-type="table" hwp:id="xref-table-wrap-4-3" hwp:rel-id="T4">Table 4</xref>. For the completely correct mapped reads, TopHat2-no-realignment mapping rate drops significantly to 82.6% (line 2 column 1 of <xref rid="tbl4" ref-type="table" hwp:id="xref-table-wrap-4-4" hwp:rel-id="T4">Table 4</xref>) compared to the simulated dataset from TopHat2paper (line 2 column 1 of <xref rid="tbl3" ref-type="table" hwp:id="xref-table-wrap-3-11" hwp:rel-id="T3">Table 3</xref>). STAR-1-pass achieves practically the same sensitivity as TopHat2 (81.3%, lines 1 column 1 of <xref rid="tbl4" ref-type="table" hwp:id="xref-table-wrap-4-5" hwp:rel-id="T4">Table 4</xref>). At the same time STAR-1-pass achieves a significantly higher mapping rate than TopHat2-no-realignment for partially (≥150b out of 200b) correct alignments (95% vs 83.7%, lines 1 vs 2 column 2). STAR-1-pass also soundly outperforms TopHat2-no-relaignment in the splice junction detection sensitivity: 92.7% vs. 84.3% (lines 1,2 column 6) and junction FDR: 0.3% vs. 0.9%.</p><table-wrap id="tbl4" orientation="portrait" position="float" hwp:id="T4" hwp:rev-id="xref-table-wrap-4-1 xref-table-wrap-4-2 xref-table-wrap-4-3 xref-table-wrap-4-4 xref-table-wrap-4-5 xref-table-wrap-4-6 xref-table-wrap-4-7"><object-id pub-id-type="other" hwp:sub-type="pisa">biorxiv;000851v1/TBL4</object-id><object-id pub-id-type="other" hwp:sub-type="slug">T4</object-id><object-id pub-id-type="publisher-id">tbl4</object-id><label>Table 4.</label><caption hwp:id="caption-6"><title hwp:id="title-15">Mapping statistics for the simulated RNA-seq dataset simulate with a realistic gene expression distribution.</title></caption><graphic xlink:href="000851_tbl4" position="float" orientation="portrait" hwp:id="graphic-6"/></table-wrap><p hwp:id="p-22">The realignment (2-pass) strategy significantly improves performance of both aligners: the percentage of completely correctly mapped reads is increased to 98.5% for STAR-2-pass (line 3 of <xref rid="tbl4" ref-type="table" hwp:id="xref-table-wrap-4-6" hwp:rel-id="T4">Table 4</xref>), which is slightly higher than 96.4% for TopHat2-realignment (line 4 of <xref rid="tbl4" ref-type="table" hwp:id="xref-table-wrap-4-7" hwp:rel-id="T4">Table 4</xref>).</p><p hwp:id="p-23">TopHat2 generates a large number of alignments for which only one mate is aligned correctly, which can be seen in <xref rid="fig1" ref-type="fig" hwp:id="xref-fig-1-5" hwp:rel-id="F1">Figure 1</xref> as an abrupt drop in the percentage of reads with x=100 correctly mapped bases. Most of these alignments are false “chimeras” (alignments with mates mapping to different chromosomes or in wrong orientation). This effect is especially pronounced for TopHat2-no-realignment mapping of simulated data with realistic gene expression distribution (<xref rid="fig1" ref-type="fig" hwp:id="xref-fig-1-6" hwp:rel-id="F1">Figure 1c</xref>). In this case, even though the simulated data only contained perfect transcriptomic reads without mismatches or indels, TopHat2 produces ∼2 Million (10% of all reads) of false chimeras, revealing the danger of outputting unpaired alignments.</p></sec></sec></body><back><ref-list hwp:id="ref-list-1"><title hwp:id="title-16">References</title><ref id="c1" hwp:id="ref-1" hwp:rev-id="xref-ref-1-1"><label>1.</label><citation publication-type="journal" citation-type="journal" ref:id="000851v1.1" ref:linkable="yes" ref:use-reference-as-is="yes" hwp:id="citation-1"><string-name name-style="western" hwp:sortable="Kim D."><surname>Kim</surname>, <given-names>D.</given-names></string-name>, <etal>et al.</etal>, <article-title hwp:id="article-title-2">TopHat2: accurate alignment of transcriptomes in the presence of insertions, deletions and gene fusions</article-title>. <source hwp:id="source-1">Genome biology</source>, <year>2013</year>. <volume>14</volume>(<issue>4</issue>): p. <fpage>R36</fpage>.</citation></ref><ref id="c2" hwp:id="ref-2" hwp:rev-id="xref-ref-2-1 xref-ref-2-2 xref-ref-2-3"><label>2.</label><citation publication-type="journal" citation-type="journal" ref:id="000851v1.2" ref:linkable="yes" ref:use-reference-as-is="yes" hwp:id="citation-2"><string-name name-style="western" hwp:sortable="Dobin A."><surname>Dobin</surname>, <given-names>A.</given-names></string-name>, <etal>et al.</etal>, <article-title hwp:id="article-title-3">STAR: ultrafast universal RNA-seq aligner</article-title>. <source hwp:id="source-2">Bioinformatics</source>, <year>2013</year>. <volume>29</volume>(<issue>1</issue>): p. <fpage>15</fpage>–<lpage>21</lpage>.</citation></ref><ref id="c3" hwp:id="ref-3" hwp:rev-id="xref-ref-3-1"><label>3.</label><citation publication-type="journal" citation-type="journal" ref:id="000851v1.3" ref:linkable="yes" ref:use-reference-as-is="yes" hwp:id="citation-3"><string-name name-style="western" hwp:sortable="Chen R."><surname>Chen</surname>, <given-names>R.</given-names></string-name>, <etal>et al.</etal>, <article-title hwp:id="article-title-4">Personal omics profiling reveals dynamic molecular and medical phenotypes</article-title>. <source hwp:id="source-3">Cell</source>, <year>2012</year>. <volume>148</volume>(<issue>6</issue>): p. <fpage>1293</fpage>–<lpage>307</lpage>.</citation></ref></ref-list></back></article>
